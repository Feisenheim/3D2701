

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>君弘君易交易系统（PYTHON） 0.2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> 君弘君易交易系统（PYTHON）
          

          
          </a>

          
            
            
              <div class="version">
                0.2.2
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/install">安装指南</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-install-download">1. 下载客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">2. 下载策略安装包</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">3. 安装</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id5">3.1 首次安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id6">3.2 更新</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">4. 验证安装是否成功</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/tutorial">快速上手</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-tutorial-install">1. 安装策略模板库</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-tutorial-write">2. 编写第一个策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-tutorial-run">3. 运行策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-tutorial-live">4. 第三方库依赖（实盘）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-tutorial-qna">5. 常见问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/overview">策略程序架构</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-overview-init">1. 策略程序初始化</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-overview-entry">2. 策略入口</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-overview-md">3. 行情事件处理函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-overview-td">4. 交易事件处理函数</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/concepts">重要概念</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#symbol">symbol - 代码标识</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-symbol-market">交易市场代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-symbol-instrument">交易标的代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-symbol-subscribe">实时行情可订阅数据类型</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mode">mode 运行模式</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-mode-backtest">回测模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-mode-sim">模拟模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-concepts-mode-live">实盘模式</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#context">context 策略上下文</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api/datamodels">数据结构</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#context">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#securitybardata">SecurityBarData</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#securitytickdata">SecurityTickData</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#futurestickdata">FuturesTickData</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indextickdata">IndexTickData</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tickbytickentrust">TickByTickEntrust</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tickbyticktrade">TickByTickTrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#order">Order</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#trade">Trade</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#position">Position</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#canceldetail">CancelDetail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api/sparkquant">API介绍</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api/scheduler">定时器</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#schedule">schedule - 设定定时任务</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#unschedule">unschedule - 取消定时任务</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api/strategyapi">策略接口</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context">context - 策略上下文</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#module-sparkquant.main">run - 启动策略</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api/mdapi">数据订阅</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#subscribe">subscribe - 订阅行情</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-mdapi-query">数据查询</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#history">history - 查询历史行情</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#history-n-n">history_n - 查询最新n条历史行情</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-trading-dates">get_trading_dates - 获取交易日历</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-instrument-info">get_instrument_info - 查询合约基础信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-instrument-list">get_instrument_list - 查询成分股列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-dividend">get_dividend - 查询分红送配</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#is-suspended">is_suspended - 是否停盘</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#is-st-stock-st">is_st_stock - 是否是ST股票</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-turnover-rate">get_turnover_rate - 获取当日换手率</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-financials">get_financials - 查询财务报告数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-money-flow">get_money_flow - 查询资金流向</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#get-fundamentals">get_fundamentals - 获取财务数据</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-mdapi-callback">数据事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#on-tick-tick">on_tick - 返回Tick数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#on-bar-bar">on_bar - 返回Bar数据</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-api/tdapi">交易函数</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#order-volume">order_volume - 指定数量下单</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#order-batch">order_batch - 批量下单</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#cancel-order">cancel_order - 撤单</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#report-params">report_params - 上报参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#report-indexes">report_indexes - 上报自定义指标</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-tdapi-callback">交易事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#on-order-status">on_order_status - 返回报单状态</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#on-execution-report">on_execution_report - 返回成交回报</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#on-set-params">on_set_params - 返回策略参数修改回报</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api/enums">枚举常量</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#accounttype">AccountType</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#adjust">Adjust</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cancelflag">CancelFlag</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#credittype">CreditType</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#codetable">CodeTable</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hedgeflag">HedgeFlag</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#orderstatus">OrderStatus</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#positioneffect">PositionEffect</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#positionside">PositionSide</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#marketcode">MarketCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ordertype">OrderType</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#orderside">OrderSide</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tradereporttype">TradeReportType</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api/financials">财务数据信息</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#income">income</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cash-flow">cash_flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#balance">balance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api/errornos">错误码</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-errors-ok">成功（0）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#oms-2000-2999">OMS（2000~2999）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#manager-3000-3999">Manager（3000~3999）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-errors-md">行情服务（7000~7999）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-8000-8999">交易API（8000~8999）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-errors-template">策略模板（9000~9999）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/examples">策略示例</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-examples-buy-and-hold">买入&amp;持有策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-examples-sma">双均线策略</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/pack">策略加密</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-pack-init">1. 环境准备</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#cython">1.1 安装cython</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-pack-init-unzip">1.2 解压加密工具</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-pack-main">2. 加密可执行程序和动态库</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-pack-main-ui">2.1 程序界面</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-pack-main-env">2.2 选择版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#exe">2.3 添加需要加密成exe的文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pyd">2.4 添加需要加密成pyd的文件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-pack-run">3. 运行加密策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#intro-pack-qna">4. 常见问题</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#pyhonxx-dll">4.1 计算机丢失Pyhonxx.dll</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#no-module-named-encodings">4.2 No module named ‘encodings’</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#intro-pack-qna-3">4.3 提示没有安装cython</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">君弘君易交易系统（PYTHON）</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>君弘君易交易系统（PYTHON） 0.2.2 documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python">
<h1>君弘君易交易系统 (PYTHON)<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-intro/install"></span><div class="section" id="intro-install">
<span id="id1"></span><h2>安装指南<a class="headerlink" href="#intro-install" title="Permalink to this headline">¶</a></h2>
<div class="section" id="intro-install-download">
<span id="id2"></span><h3>1. 下载客户端<a class="headerlink" href="#intro-install-download" title="Permalink to this headline">¶</a></h3>
<p>下载君弘君易交易系统客户端，并默认安装</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">python策略执行时会使用客户端的部分配置文件。
如未正确安装客户端，运行会提示“9010，文件配置加载失败”。</p>
</div>
</div>
<div class="section" id="id3">
<h3>2. 下载策略安装包<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>获取策略模板版本压缩包 <code class="code docutils literal notranslate"><span class="pre">策略模板版本Vxx.xx.xx-release-python3.7z</span></code>，并解压到工作目录（以D:\Strategy为例）。
目录结构及其说明如下图：</p>
<img alt="_images/dir_desc.png" src="_images/dir_desc.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">确保python安装目录以及工作目录中不含有空格，否则会导致策略运行失败。</p>
</div>
</div>
<div class="section" id="id4">
<h3>3. 安装<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id5">
<h4>3.1 首次安装<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>直接通过pip install安装</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install sparkquant-xxx.xxx.xxx-py3-none-any.whl
</pre></div>
</div>
<p>结果如图所示：</p>
<img alt="_images/install_whl.png" src="_images/install_whl.png" />
</div>
<div class="section" id="id6">
<h4>3.2 更新<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>先卸载旧版本</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip uninstall sparkquant
</pre></div>
</div>
<ul class="simple">
<li>重新安装新版本</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install sparkquant-xxx.xxx.xxx-py3-none-any.whl
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>4. 验证安装是否成功<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>cd到examples文件夹，运行以下命令启动demo程序</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">确保在策略同级目录下，存在strategy.ini文件，该文件指定了回测模式、交易账号等信息。如果策略运行错误，可查看同级的log目录，分为网关日志、行情日志、交易日志和策略日志。</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 极简的买入持有策略</span>
python BaH_demo.py

<span class="c1"># 包含常用api的用法</span>
python simulation_demo.py

<span class="c1"># 均线策略，需要依赖talib包</span>
<span class="c1"># pip install ta-lib</span>
python SMA_demo.py
</pre></div>
</div>
<p>运行SMA_demo成功的示例如下：</p>
<img alt="_images/run_demo.png" src="_images/run_demo.png" />
<p>策略文档上传至实盘云机前可选择加密，具体请参考 <a class="reference internal" href="index.html#intro-pack"><span class="std std-ref">策略加密</span></a></p>
</div>
</div>
<span id="document-intro/tutorial"></span><div class="section" id="intro-tutorial">
<span id="id1"></span><h2>快速上手<a class="headerlink" href="#intro-tutorial" title="Permalink to this headline">¶</a></h2>
<div class="section" id="intro-tutorial-install">
<span id="id2"></span><h3>1. 安装策略模板库<a class="headerlink" href="#intro-tutorial-install" title="Permalink to this headline">¶</a></h3>
<p>具体请参考 <a class="reference internal" href="index.html#intro-install"><span class="std std-ref">安装指南</span></a></p>
</div>
<div class="section" id="intro-tutorial-write">
<span id="id3"></span><h3>2. 编写第一个策略<a class="headerlink" href="#intro-tutorial-write" title="Permalink to this headline">¶</a></h3>
<p>该策略为最简单的买入并持有万科A股票。当接收到第一个Bar行情时即买入股票，并一直持有。</p>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Buy and Hold</span>

<span class="kn">from</span> <span class="nn">sparkquant</span> <span class="k">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="c1"># 设置这个策略当中会用到的参数，在策略中可以随时调用，这个策略使用买入并持有万科A股票</span>
    <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">=</span> <span class="s1">&#39;SZ.000002&#39;</span>   <span class="c1"># 使用的合约编号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span> <span class="o">=</span> <span class="s1">&#39;6814&#39;</span>     <span class="c1"># 报单时指定的账号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span> <span class="o">=</span> <span class="mi">100</span>           <span class="c1"># 报单数量（股票单位：股，期货单位：手）</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="kc">False</span>           <span class="c1"># 是否已报单</span>

    <span class="c1"># 订阅行情数据</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;订阅合约...&#39;</span><span class="p">)</span>
    <span class="n">subscribe</span><span class="p">([</span><span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">+</span> <span class="s1">&#39;.bar&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">on_bar</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">bar_dict</span><span class="p">):</span>
    <span class="c1"># print(bar_dict)</span>
    <span class="c1"># 接收bar数据，在收到第一个bar行情时买入股票</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">fired</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;报单...&quot;</span><span class="p">)</span>
        <span class="n">order_price</span> <span class="o">=</span> <span class="n">bar_dict</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>  <span class="c1"># 使用最新价</span>
        <span class="n">order_volume</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span><span class="p">,</span> <span class="n">order_price</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">on_order_status</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="c1"># 如何接收订单状态变化事件</span>
    <span class="c1"># 在实盘中，需要考虑报单不能全部成交的情况，并在此处进行追单处理</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到订单状态变化：</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_execution_report</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">):</span>
    <span class="c1"># 如何接收成交回报事件</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到成交回报： </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 如何开始运行策略</span>
    <span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
        <span class="n">on_bar</span><span class="o">=</span><span class="n">on_bar</span><span class="p">,</span>
        <span class="n">on_order_status</span><span class="o">=</span><span class="n">on_order_status</span><span class="p">,</span>
        <span class="n">on_execution_report</span><span class="o">=</span><span class="n">on_execution_report</span><span class="p">,</span>
        <span class="n">is_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="intro-tutorial-run">
<span id="id4"></span><h3>3. 运行策略<a class="headerlink" href="#intro-tutorial-run" title="Permalink to this headline">¶</a></h3>
<p>可以选择在Python IDE中运行，也可以直接在命令窗口运行如下代码</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python demo.py
</pre></div>
</div>
<p>如需退出策略执行，输入 <code class="code docutils literal notranslate"><span class="pre">q</span></code> 并回车。</p>
<p>更多策略接口请参考 <a class="reference internal" href="index.html#api"><span class="std std-ref">API介绍</span></a></p>
<p>更多策略示例请参考 <a class="reference internal" href="index.html#intro-examples"><span class="std std-ref">策略示例</span></a></p>
</div>
<div class="section" id="intro-tutorial-live">
<span id="id5"></span><h3>4. 第三方库依赖（实盘）<a class="headerlink" href="#intro-tutorial-live" title="Permalink to this headline">¶</a></h3>
<p>在实盘环境中，策略如调用了云机环境中未提供的第三方Python库，请联系平台客服人员进行安装，否则会导致策略无法正常运行。</p>
<p>云机中默认已安装的第三方库：</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="6%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">模块名称</th>
<th class="head">版本</th>
<th class="head">简介</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NumPy</td>
<td>1.9.3</td>
<td>NumPy系统是Python的一种开源的数值计算扩展。NumPy（Numeric Python）提供了许多高级的数值编程工具，如：矩阵数据类型、矢量处理，以及精密的运算库。专为进行严格的数字处理而产生</td>
</tr>
<tr class="row-odd"><td>TALib</td>
<td>0.4.9</td>
<td>TALib是一个处理金融数据和技术分析的开放代码库</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="intro-tutorial-qna">
<span id="id6"></span><h3>5. 常见问题<a class="headerlink" href="#intro-tutorial-qna" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>启动策略时提示“交易服务内部初始化错误”</li>
</ul>
<img alt="_images/common_error_1.png" src="_images/common_error_1.png" />
<p>解决方案：该文件可能被未正常结束的python进程占用，结束此进程再试。多个策略同时运行时，请确保每个策略可执行文件置于不同目录下。</p>
</div>
</div>
<span id="document-intro/overview"></span><div class="section" id="intro-overview">
<span id="id1"></span><h2>策略程序架构<a class="headerlink" href="#intro-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="intro-overview-init">
<span id="id2"></span><h3>1. 策略程序初始化<a class="headerlink" href="#intro-overview-init" title="Permalink to this headline">¶</a></h3>
<p>通过init函数初始化策略,策略启动即会自动执行。在init函数中可以：</p>
<ul class="simple">
<li>定义全局变量。
通过添加 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 包含的属性可以定义全局变量，如context.x,该属性可以在全文中进行传递。</li>
<li>定义调度任务。
可以通过 <a class="reference internal" href="index.html#schedule"><span class="std std-ref">schedule - 设定定时任务</span></a> ，程序在指定时间自动执行策略算法。</li>
<li>准备历史数据。
通过 <a class="reference internal" href="index.html#api-mdapi-query"><span class="std std-ref">数据查询</span></a> 函数获取历史数据</li>
<li>订阅实时行情。
通过 <a class="reference internal" href="index.html#subscribe"><span class="std std-ref">subscribe - 订阅行情</span></a> ，用以触发行情 <a class="reference internal" href="index.html#api-mdapi-callback"><span class="std std-ref">数据事件</span></a> 处理函数。</li>
</ul>
<p>策略 <strong>必须提供init函数</strong> 的实现，以在其中进行必要的初始化操作。</p>
</div>
<div class="section" id="intro-overview-entry">
<span id="id3"></span><h3>2. 策略入口<a class="headerlink" href="#intro-overview-entry" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="index.html#module-sparkquant.main"><span class="std std-ref">run - 启动策略</span></a> 函数用于启动策略。通过 <a class="reference internal" href="index.html#module-sparkquant.main"><span class="std std-ref">run - 启动策略</span></a> 函数可以注册各种用户自定义的回调函数，指定配置文件路径和日志文件路径，
以及运行模式（异步/同步）等。其典型应用方式如下：</p>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
        <span class="n">on_bar</span><span class="o">=</span><span class="n">on_bar</span><span class="p">,</span>
        <span class="n">on_tick</span><span class="o">=</span><span class="n">on_tick</span><span class="p">,</span>
        <span class="n">on_order_status</span><span class="o">=</span><span class="n">on_order_status</span><span class="p">,</span>
        <span class="n">on_execution_report</span><span class="o">=</span><span class="n">on_execution_report</span><span class="p">,</span>
        <span class="n">config_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">log_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">is_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>策略 <strong>必须调用run函数</strong> 以启动策略。</p>
</div>
<div class="section" id="intro-overview-md">
<span id="id4"></span><h3>3. 行情事件处理函数<a class="headerlink" href="#intro-overview-md" title="Permalink to this headline">¶</a></h3>
<p>在 <a class="reference internal" href="index.html#module-sparkquant.main"><span class="std std-ref">run - 启动策略</span></a> 函数中可以注册返回tick数据和返回bar数据的回调函数。当通过 <a class="reference internal" href="index.html#subscribe"><span class="std std-ref">subscribe - 订阅行情</span></a> 函数订阅的行情到达时，会
产生如下的 <a class="reference internal" href="index.html#api-mdapi-callback"><span class="std std-ref">数据事件</span></a> (视订阅的数据而定):</p>
<ul class="simple">
<li>盘口tick数据事件。
通过 <a class="reference internal" href="index.html#on-tick-tick"><span class="std std-ref">on_tick - 返回Tick数据</span></a> 回调函数响应tick数据事件，可以在该函数中继续添加自己的策略逻辑,如进行数据计算、交易等。</li>
<li>分时bar数据事件。
通过 <a class="reference internal" href="index.html#on-bar-bar"><span class="std std-ref">on_bar - 返回Bar数据</span></a> 回调函数响应bar数据事件，可以在该函数中继续添加自己的策略逻辑，如进行数据计算、交易等</li>
</ul>
</div>
<div class="section" id="intro-overview-td">
<span id="id5"></span><h3>4. 交易事件处理函数<a class="headerlink" href="#intro-overview-td" title="Permalink to this headline">¶</a></h3>
<p>在 <a class="reference internal" href="index.html#module-sparkquant.main"><span class="std std-ref">run - 启动策略</span></a> 函数中可以注册返回报单状态和返回成交回报的回调函数。当通过 <a class="reference internal" href="index.html#module-sparkquant.api.td_api"><span class="std std-ref">交易函数</span></a> 进行交易时，会产生如下 <a class="reference internal" href="index.html#api-tdapi-callback"><span class="std std-ref">交易事件</span></a> ：</p>
<ul class="simple">
<li>报单状态变化事件。
当报单状态产生变化时会触发 <a class="reference internal" href="index.html#on-order-status"><span class="std std-ref">on_order_status - 返回报单状态</span></a> 回调函数，用于监测委托状态变更。</li>
<li>成交回报事件。
当交易委托被执行后会触发 <a class="reference internal" href="index.html#on-execution-report"><span class="std std-ref">on_execution_report - 返回成交回报</span></a> 回调函数，用于监测委托执行状态。</li>
</ul>
</div>
</div>
<span id="document-intro/concepts"></span><div class="section" id="intro-concepts">
<span id="id1"></span><h2>重要概念<a class="headerlink" href="#intro-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="symbol">
<span id="intro-concepts-symbol"></span><h3>symbol - 代码标识<a class="headerlink" href="#symbol" title="Permalink to this headline">¶</a></h3>
<p>代码标识（symbol）一般由 <a class="reference internal" href="#intro-concepts-symbol-market"><span class="std std-ref">交易市场代码</span></a> ， <a class="reference internal" href="#intro-concepts-symbol-instrument"><span class="std std-ref">交易标的代码</span></a> , 和 <a class="reference internal" href="#intro-concepts-symbol-subscribe"><span class="std std-ref">实时行情可订阅数据类型</span></a> 按某种规则组合而成，
典型的组合规则举例如下：</p>
<blockquote>
<div><ul class="simple">
<li>行情和交易的symbol由“交易市场代码.交易标的代码”组合而成，例如 <code class="code docutils literal notranslate"><span class="pre">history('SH.600000',</span> <span class="pre">'1tick',</span> <span class="pre">'2018/08/06</span> <span class="pre">10:0:0')</span></code> 。</li>
<li>订阅行情的symbol有“交易市场代码.交易标的代码.实时行情可订阅数据类型”组合而成，例如 <code class="code docutils literal notranslate"><span class="pre">subscribe('SZ.000002.bar')</span></code> 。</li>
</ul>
</div></blockquote>
<div class="section" id="intro-concepts-symbol-market">
<span id="id2"></span><h4>交易市场代码<a class="headerlink" href="#intro-concepts-symbol-market" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">市场代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SH</td>
<td>上海证券交易所</td>
</tr>
<tr class="row-odd"><td>SZ</td>
<td>深圳证券交易所</td>
</tr>
<tr class="row-even"><td>CFFEX</td>
<td>中金所</td>
</tr>
<tr class="row-odd"><td>SHFE</td>
<td>上期所</td>
</tr>
<tr class="row-even"><td>CZCE</td>
<td>郑商所</td>
</tr>
<tr class="row-odd"><td>DEC</td>
<td>大商所</td>
</tr>
<tr class="row-even"><td>HK</td>
<td>香港证券交易所</td>
</tr>
<tr class="row-odd"><td>SHOP</td>
<td>上交所期权市场</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="intro-concepts-symbol-instrument">
<span id="id3"></span><h4>交易标的代码<a class="headerlink" href="#intro-concepts-symbol-instrument" title="Permalink to this headline">¶</a></h4>
<p>交易表代码是指交易所给出的交易标的代码, 包括股票, 期货, 期权, 指数, 基金等代码。
具体的代码请参考交易所的给出的证券代码定义。</p>
</div>
<div class="section" id="intro-concepts-symbol-subscribe">
<span id="id4"></span><h4>实时行情可订阅数据类型<a class="headerlink" href="#intro-concepts-symbol-subscribe" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">数据类型名</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>tick</td>
<td>tick级行情数据</td>
</tr>
<tr class="row-odd"><td>bar</td>
<td>分钟K线数据</td>
</tr>
<tr class="row-even"><td>index</td>
<td>指数行情数据</td>
</tr>
<tr class="row-odd"><td>zw</td>
<td>逐笔委托数据 (仅深交所)</td>
</tr>
<tr class="row-even"><td>zc</td>
<td>逐笔成交数据</td>
</tr>
<tr class="row-odd"><td>fast</td>
<td>撮合行情数据 (仅深交所)</td>
</tr>
<tr class="row-even"><td>queue</td>
<td>委托队列数据</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mode">
<span id="intro-concepts-mode"></span><h3>mode 运行模式<a class="headerlink" href="#mode" title="Permalink to this headline">¶</a></h3>
<p>策略支持3种运行模式，回测模式，模拟模式和实盘模式，用户需要在运行策略时选择模式。</p>
<div class="section" id="intro-concepts-mode-backtest">
<span id="id5"></span><h4>回测模式<a class="headerlink" href="#intro-concepts-mode-backtest" title="Permalink to this headline">¶</a></h4>
<p>订阅指定时段、指定交易代码、指定数据类型的行情，行情服务器将按指定条件全速回放对应的行情数据。
适用的场景是策略回测阶段，快速验证策略的绩效是否符合预期。</p>
</div>
<div class="section" id="intro-concepts-mode-sim">
<span id="id6"></span><h4>模拟模式<a class="headerlink" href="#intro-concepts-mode-sim" title="Permalink to this headline">¶</a></h4>
<p>订阅行情服务器推送的实时行情，也就是交易所的实时行情，只在交易时段提供。
所有的交易操作由系统提供的撮合规则进行模拟撮合交易。</p>
<p>撮合规则：</p>
<p>1. tick撮合 <br>
a. 委托下达后，收到第一笔该委托标的合约的tick数据时，利用tick中的盘口数据尝试对该笔委托进行撮合：
如为买委托时，当买价-滑点&gt;=卖1价时认为该笔委托可以和卖1成交，成交量为min(委托量,卖1量*成交比例)，
如委托量还有剩余继续尝试和卖2盘口成交，依次类推直到不再成交或者全额成交。</p>
<p>b. 如该笔委托尚未进入终止状态，在收到标的合约的第一笔tick数据之后的每笔tick数据时，尝试利用该tick中的最新价对
该笔委托进行撮合：
如为买委托时，当买价-滑点&gt;=最新价时认为该笔委托在该笔tick中有成交，成交量为min(委托量,该笔tick成交量*成交比例)。</p>
<p>2. 分钟k线撮合 <br>
委托下达后，如该笔委托尚未进入终止状态，在收到每一笔分钟k线数据时，尝试利用该分钟k线的最新价对。
该笔委托进行撮合：
如为买委托时，当买价-滑点&gt;=最新价时认为该笔委托在该分钟k线内有成交，成交量为min(委托量,该分钟k线内成交量*成交比例)。</p>
</div>
<div class="section" id="intro-concepts-mode-live">
<span id="id7"></span><h4>实盘模式<a class="headerlink" href="#intro-concepts-mode-live" title="Permalink to this headline">¶</a></h4>
<p>订阅行情服务器推送的实时行情，也就是交易所的实时行情，只在交易时段提供。
所有的交易操作均会交由指定的交易所去执行。</p>
</div>
</div>
<div class="section" id="context">
<h3>context 策略上下文<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h3>
<p id="intro-concepts-context">context是策略运行上下文环境对象，该对象将会在你的算法策略的任何方法之间做传递，
其中包含了一些常用的属性和方法（概要信息请参考 <a class="reference internal" href="index.html#api-datamodels"><span class="std std-ref">数据结构</span></a> 部分的 <a class="reference internal" href="index.html#context"><span class="std std-ref">Context</span></a> ，
详情信息请参考 <a class="reference internal" href="index.html#id1"><span class="std std-ref">策略接口</span></a> 部分的 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> ），用户也可以根据自己的需求定义无限多种自己随后需要的属性。</p>
</div>
</div>
<span id="document-api/datamodels"></span><div class="section" id="api-datamodels">
<span id="id1"></span><h2>数据结构<a class="headerlink" href="#api-datamodels" title="Permalink to this headline">¶</a></h2>
<div class="section" id="context">
<h3>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h3>
<p>更具体的信息请参考 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="10%" />
<col width="24%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">函数名</th>
<th class="head">函数类型</th>
<th class="head">返回类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>run_mode</td>
<td>属性</td>
<td>int</td>
<td>获取运行模式，1：回测，2：模拟，3：实盘</td>
</tr>
<tr class="row-odd"><td>now</td>
<td>属性</td>
<td>datetime</td>
<td><p class="first">获取当前日期和时间:</p>
<ul class="last simple">
<li>回测模式，返回回测执行当前日期时间</li>
<li>实盘和模拟模式，返回当前机器的系统时间。</li>
</ul>
</td>
</tr>
<tr class="row-even"><td>strategy_id</td>
<td>属性</td>
<td>str</td>
<td>获取策略id</td>
</tr>
<tr class="row-odd"><td>run_id</td>
<td>属性</td>
<td>str</td>
<td>获取策略运行实例id</td>
</tr>
<tr class="row-even"><td>sys_account_id</td>
<td>属性</td>
<td>str</td>
<td>获取系统账号</td>
</tr>
<tr class="row-odd"><td>universe</td>
<td>属性</td>
<td>list[str]</td>
<td>获取所有当前订阅的合约代码</td>
</tr>
<tr class="row-even"><td>log_level</td>
<td>属性</td>
<td>int</td>
<td>获取日志级别，1: Debug, 2: Info, 3: Warn, 4: Error</td>
</tr>
<tr class="row-odd"><td>cash</td>
<td>静态</td>
<td>list[Cash]</td>
<td>策略资金账户数据列表或总资金。</td>
</tr>
<tr class="row-even"><td>position</td>
<td>静态</td>
<td>list[ <a class="reference internal" href="#position"><span class="std std-ref">Position</span></a> ]</td>
<td>查询单个标的证券的持仓列表。</td>
</tr>
<tr class="row-odd"><td>positions</td>
<td>静态</td>
<td>list[ <a class="reference internal" href="#position"><span class="std std-ref">Position</span></a> ]</td>
<td>查询策略持仓列表。</td>
</tr>
<tr class="row-even"><td>order</td>
<td>静态</td>
<td><a class="reference internal" href="#order"><span class="std std-ref">Order</span></a></td>
<td>查询单一订单详情。</td>
</tr>
<tr class="row-odd"><td>orders</td>
<td>静态</td>
<td>list[ <a class="reference internal" href="#order"><span class="std std-ref">Order</span></a>  ]</td>
<td>查策略实例订单列表，支持分页查询。</td>
</tr>
<tr class="row-even"><td>orders</td>
<td>静态</td>
<td>list[ <a class="reference internal" href="#trade"><span class="std std-ref">Trade</span></a> ]</td>
<td>查单个订单成交列表。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="securitybardata">
<h3>SecurityBarData<a class="headerlink" href="#securitybardata" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="19%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>date</td>
<td>int</td>
<td>日期 YYYYMMDD</td>
</tr>
<tr class="row-odd"><td>time</td>
<td>int</td>
<td>时间(北京时间) HHMM</td>
</tr>
<tr class="row-even"><td>open</td>
<td>float</td>
<td>开盘价</td>
</tr>
<tr class="row-odd"><td>high</td>
<td>float</td>
<td>最高价</td>
</tr>
<tr class="row-even"><td>low</td>
<td>float</td>
<td>最低价</td>
</tr>
<tr class="row-odd"><td>close</td>
<td>float</td>
<td>收盘价</td>
</tr>
<tr class="row-even"><td>volume</td>
<td>int</td>
<td>成交量</td>
</tr>
<tr class="row-odd"><td>turnover</td>
<td>int</td>
<td>成交额</td>
</tr>
<tr class="row-even"><td>open_interest</td>
<td>int</td>
<td>累计持仓总量</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="securitytickdata">
<h3>SecurityTickData<a class="headerlink" href="#securitytickdata" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="6%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>time</td>
<td>int</td>
<td>时间(HHMMSSmmm)</td>
</tr>
<tr class="row-odd"><td>status</td>
<td>int</td>
<td>状态</td>
</tr>
<tr class="row-even"><td>pre_close</td>
<td>int</td>
<td>前收盘价</td>
</tr>
<tr class="row-odd"><td>open</td>
<td>float</td>
<td>开盘价</td>
</tr>
<tr class="row-even"><td>high</td>
<td>float</td>
<td>最高价</td>
</tr>
<tr class="row-odd"><td>low</td>
<td>float</td>
<td>最低价</td>
</tr>
<tr class="row-even"><td>match</td>
<td>float</td>
<td>最新价</td>
</tr>
<tr class="row-odd"><td>ask_price1</td>
<td>float</td>
<td>申卖价1</td>
</tr>
<tr class="row-even"><td>ask_price2</td>
<td>float</td>
<td>申卖价2</td>
</tr>
<tr class="row-odd"><td>ask_price3</td>
<td>float</td>
<td>申卖价3</td>
</tr>
<tr class="row-even"><td>ask_price4</td>
<td>float</td>
<td>申卖价4</td>
</tr>
<tr class="row-odd"><td>ask_price5</td>
<td>float</td>
<td>申卖价5</td>
</tr>
<tr class="row-even"><td>ask_price6</td>
<td>float</td>
<td>申卖价6</td>
</tr>
<tr class="row-odd"><td>ask_price7</td>
<td>float</td>
<td>申卖价7</td>
</tr>
<tr class="row-even"><td>ask_price8</td>
<td>float</td>
<td>申卖价8</td>
</tr>
<tr class="row-odd"><td>ask_price9</td>
<td>float</td>
<td>申卖价9</td>
</tr>
<tr class="row-even"><td>ask_price10</td>
<td>float</td>
<td>申卖价10</td>
</tr>
<tr class="row-odd"><td>ask_vol1</td>
<td>int</td>
<td>申卖量1</td>
</tr>
<tr class="row-even"><td>ask_vol2</td>
<td>int</td>
<td>申卖量2</td>
</tr>
<tr class="row-odd"><td>ask_vol3</td>
<td>int</td>
<td>申卖量3</td>
</tr>
<tr class="row-even"><td>ask_vol4</td>
<td>int</td>
<td>申卖量4</td>
</tr>
<tr class="row-odd"><td>ask_vol5</td>
<td>int</td>
<td>申卖量5</td>
</tr>
<tr class="row-even"><td>ask_vol6</td>
<td>int</td>
<td>申卖量6</td>
</tr>
<tr class="row-odd"><td>ask_vol7</td>
<td>int</td>
<td>申卖量7</td>
</tr>
<tr class="row-even"><td>ask_vol8</td>
<td>int</td>
<td>申卖量8</td>
</tr>
<tr class="row-odd"><td>ask_vol9</td>
<td>int</td>
<td>申卖量9</td>
</tr>
<tr class="row-even"><td>ask_vol10</td>
<td>int</td>
<td>申卖量10</td>
</tr>
<tr class="row-odd"><td>bid_price1</td>
<td>float</td>
<td>申买价1</td>
</tr>
<tr class="row-even"><td>bid_price2</td>
<td>float</td>
<td>申买价2</td>
</tr>
<tr class="row-odd"><td>bid_price3</td>
<td>float</td>
<td>申买价3</td>
</tr>
<tr class="row-even"><td>bid_price4</td>
<td>float</td>
<td>申买价4</td>
</tr>
<tr class="row-odd"><td>bid_price5</td>
<td>float</td>
<td>申买价5</td>
</tr>
<tr class="row-even"><td>bid_price6</td>
<td>float</td>
<td>申买价6</td>
</tr>
<tr class="row-odd"><td>bid_price7</td>
<td>float</td>
<td>申买价7</td>
</tr>
<tr class="row-even"><td>bid_price8</td>
<td>float</td>
<td>申买价8</td>
</tr>
<tr class="row-odd"><td>bid_price9</td>
<td>float</td>
<td>申买价9</td>
</tr>
<tr class="row-even"><td>bid_price10</td>
<td>float</td>
<td>申买价10</td>
</tr>
<tr class="row-odd"><td>bid_vol1</td>
<td>int</td>
<td>申买量1</td>
</tr>
<tr class="row-even"><td>bid_vol2</td>
<td>int</td>
<td>申买量2</td>
</tr>
<tr class="row-odd"><td>bid_vol3</td>
<td>int</td>
<td>申买量3</td>
</tr>
<tr class="row-even"><td>bid_vol4</td>
<td>int</td>
<td>申买量4</td>
</tr>
<tr class="row-odd"><td>bid_vol5</td>
<td>int</td>
<td>申买量5</td>
</tr>
<tr class="row-even"><td>bid_vol6</td>
<td>int</td>
<td>申买量6</td>
</tr>
<tr class="row-odd"><td>bid_vol7</td>
<td>int</td>
<td>申买量7</td>
</tr>
<tr class="row-even"><td>bid_vol8</td>
<td>int</td>
<td>申买量8</td>
</tr>
<tr class="row-odd"><td>bid_vol9</td>
<td>int</td>
<td>申买量9</td>
</tr>
<tr class="row-even"><td>bid_vol10</td>
<td>int</td>
<td>申买量10</td>
</tr>
<tr class="row-odd"><td>num_trades</td>
<td>int</td>
<td>成交笔数</td>
</tr>
<tr class="row-even"><td>volume</td>
<td>int</td>
<td>成交量</td>
</tr>
<tr class="row-odd"><td>turnover</td>
<td>int</td>
<td>成交额</td>
</tr>
<tr class="row-even"><td>total_bid_vol</td>
<td>int</td>
<td>委托买入总量</td>
</tr>
<tr class="row-odd"><td>total_ask_vol</td>
<td>int</td>
<td>委托卖出总量</td>
</tr>
<tr class="row-even"><td>weighted_avg_bid_price</td>
<td>float</td>
<td>加权平均委买价格</td>
</tr>
<tr class="row-odd"><td>weighted_avg_ask_price</td>
<td>float</td>
<td>加权平均委卖价格</td>
</tr>
<tr class="row-even"><td>iopv</td>
<td>int</td>
<td>IOPV净值估值</td>
</tr>
<tr class="row-odd"><td>yield_to_maturity</td>
<td>float</td>
<td>到期收益率</td>
</tr>
<tr class="row-even"><td>high_limited</td>
<td>float</td>
<td>涨停价</td>
</tr>
<tr class="row-odd"><td>low_limited</td>
<td>float</td>
<td>跌停价</td>
</tr>
<tr class="row-even"><td>prefix</td>
<td>str</td>
<td>证券信息前缀</td>
</tr>
<tr class="row-odd"><td>syl1</td>
<td>float</td>
<td>市盈率1,2位小数.股票：价格/上年每股利润,债券：每百元应计利息</td>
</tr>
<tr class="row-even"><td>syl2</td>
<td>float</td>
<td>市盈率2,2位小数.股票：价格/本年每股利润,
债券：到期收益率,基金：每百份的IOPV 或净值 权证：溢价率</td>
</tr>
<tr class="row-odd"><td>sd2</td>
<td>float</td>
<td>升跌2（对比上一笔）</td>
</tr>
<tr class="row-even"><td>trading_phase_code</td>
<td>str</td>
<td><p class="first">交易状态代码, 上交所与深交所字段含义不同，参见以下注解：</p>
<ul class="last">
<li><p class="first">上交所：该字段为8位字符串，左起每位表示特定的含义，无定义则填空格。</p>
<blockquote>
<div><ul class="simple">
<li>第1位：‘S’表示启动（开市前）时段，‘C’表示集合竞价时段，‘T’表示连续交易时段，‘B’表示休市时段，‘E’表示闭市时段，‘P’表示产品停牌，<br>
‘M’表示可恢复交易的熔断时段（盘中集合竞价），‘N’表示不可恢复交易的熔断时段（暂停交易至闭市），‘D’表示集合竞价阶段结束到连续竞价阶段开始之前的时段（如有）</li>
<li>第2位：‘0’表示此产品不可正常交易, ‘1’表示此产品可正常交易，无意义填空格。</li>
<li>第3位：‘0’表示未上市， ‘1’表示已上市。</li>
<li>第4位:‘0’表示此产品在当前时段不接受进行新订单申报，‘1’表示此产品在当前时段可接受进行新订单申报。无意义填空格。</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">深交所： 产品所处的交易阶段代码</p>
<blockquote>
<div><ul class="simple">
<li>第0位：S=启动（开市前），O=开盘集合竞价，T=连续竞价，B=休市，C=收盘集合竞价, E=已闭市，H=临时停牌，A=盘后交易，V=波动性中断</li>
<li>第1位：0=正常状态，1=全天停牌</li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>pre_iopv</td>
<td>int</td>
<td>基金T-1日收盘时刻IOPV.仅标的为基金时有效</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="futurestickdata">
<h3>FuturesTickData<a class="headerlink" href="#futurestickdata" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="22%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>time</td>
<td>int</td>
<td>时间(HHMMSSmmm)</td>
</tr>
<tr class="row-odd"><td>status</td>
<td>int</td>
<td>状态</td>
</tr>
<tr class="row-even"><td>pre_open_interest</td>
<td>int</td>
<td>昨持仓</td>
</tr>
<tr class="row-odd"><td>pre_close</td>
<td>float</td>
<td>昨收盘价</td>
</tr>
<tr class="row-even"><td>pre_settle_price</td>
<td>float</td>
<td>昨结算价</td>
</tr>
<tr class="row-odd"><td>open</td>
<td>float</td>
<td>开盘价</td>
</tr>
<tr class="row-even"><td>high</td>
<td>float</td>
<td>最高价</td>
</tr>
<tr class="row-odd"><td>low</td>
<td>float</td>
<td>最低价</td>
</tr>
<tr class="row-even"><td>match</td>
<td>float</td>
<td>最新价</td>
</tr>
<tr class="row-odd"><td>volume</td>
<td>int</td>
<td>成交总量</td>
</tr>
<tr class="row-even"><td>turnover</td>
<td>int</td>
<td>成交总金额</td>
</tr>
<tr class="row-odd"><td>open_interest</td>
<td>int</td>
<td>持仓总量</td>
</tr>
<tr class="row-even"><td>close</td>
<td>float</td>
<td>今收盘</td>
</tr>
<tr class="row-odd"><td>settle_price</td>
<td>float</td>
<td>今结算价</td>
</tr>
<tr class="row-even"><td>high_limited</td>
<td>float</td>
<td>涨停价</td>
</tr>
<tr class="row-odd"><td>low_limited</td>
<td>float</td>
<td>跌停价</td>
</tr>
<tr class="row-even"><td>pre_delta</td>
<td>int</td>
<td>昨虚实度</td>
</tr>
<tr class="row-odd"><td>curr_delta</td>
<td>int</td>
<td>今虚实度</td>
</tr>
<tr class="row-even"><td>ask_price1</td>
<td>float</td>
<td>申卖价1</td>
</tr>
<tr class="row-odd"><td>ask_price2</td>
<td>float</td>
<td>申卖价2</td>
</tr>
<tr class="row-even"><td>ask_price3</td>
<td>float</td>
<td>申卖价3</td>
</tr>
<tr class="row-odd"><td>ask_price4</td>
<td>float</td>
<td>申卖价4</td>
</tr>
<tr class="row-even"><td>ask_price5</td>
<td>float</td>
<td>申卖价5</td>
</tr>
<tr class="row-odd"><td>ask_vol1</td>
<td>int</td>
<td>申卖量1</td>
</tr>
<tr class="row-even"><td>ask_vol2</td>
<td>int</td>
<td>申卖量2</td>
</tr>
<tr class="row-odd"><td>ask_vol3</td>
<td>int</td>
<td>申卖量3</td>
</tr>
<tr class="row-even"><td>ask_vol4</td>
<td>int</td>
<td>申卖量4</td>
</tr>
<tr class="row-odd"><td>ask_vol5</td>
<td>int</td>
<td>申卖量5</td>
</tr>
<tr class="row-even"><td>bid_price1</td>
<td>float</td>
<td>申买价1</td>
</tr>
<tr class="row-odd"><td>bid_price2</td>
<td>float</td>
<td>申买价2</td>
</tr>
<tr class="row-even"><td>bid_price3</td>
<td>float</td>
<td>申买价3</td>
</tr>
<tr class="row-odd"><td>bid_price4</td>
<td>float</td>
<td>申买价4</td>
</tr>
<tr class="row-even"><td>bid_price5</td>
<td>float</td>
<td>申买价5</td>
</tr>
<tr class="row-odd"><td>bid_vol1</td>
<td>int</td>
<td>申买量1</td>
</tr>
<tr class="row-even"><td>bid_vol2</td>
<td>int</td>
<td>申买量2</td>
</tr>
<tr class="row-odd"><td>bid_vol3</td>
<td>int</td>
<td>申买量3</td>
</tr>
<tr class="row-even"><td>bid_vol4</td>
<td>int</td>
<td>申买量4</td>
</tr>
<tr class="row-odd"><td>bid_vol5</td>
<td>int</td>
<td>申买量5</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="indextickdata">
<h3>IndexTickData<a class="headerlink" href="#indextickdata" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="18%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>time</td>
<td>int</td>
<td>时间(HHMMSSmmmm)</td>
</tr>
<tr class="row-odd"><td>open</td>
<td>float</td>
<td>今开盘指数</td>
</tr>
<tr class="row-even"><td>high</td>
<td>float</td>
<td>最高指数</td>
</tr>
<tr class="row-odd"><td>low</td>
<td>float</td>
<td>最低指数</td>
</tr>
<tr class="row-even"><td>match</td>
<td>float</td>
<td>最新指数</td>
</tr>
<tr class="row-odd"><td>volume</td>
<td>int</td>
<td>参与计算相应指数的交易数量</td>
</tr>
<tr class="row-even"><td>turnover</td>
<td>int</td>
<td>参与计算相应指数的成交金额</td>
</tr>
<tr class="row-odd"><td>pre_close</td>
<td>float</td>
<td>前收盘指数</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tickbytickentrust">
<h3>TickByTickEntrust<a class="headerlink" href="#tickbytickentrust" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>channel_no</td>
<td>int</td>
<td>频道代码</td>
</tr>
<tr class="row-odd"><td>seq</td>
<td>int</td>
<td>委托序号(在同一个channel_no内唯一，从1开始连续)</td>
</tr>
<tr class="row-even"><td>price</td>
<td>int</td>
<td>委托价格</td>
</tr>
<tr class="row-odd"><td>qty</td>
<td>int</td>
<td>委托数量</td>
</tr>
<tr class="row-even"><td>side</td>
<td>str</td>
<td>‘1’:买; ‘2’:卖; ‘G’:借入; ‘F’:出借</td>
</tr>
<tr class="row-odd"><td>ord_type</td>
<td>str</td>
<td>订单类别: ‘1’: 市价; ‘2’: 限价; ‘U’: 本方最优</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tickbyticktrade">
<h3>TickByTickTrade<a class="headerlink" href="#tickbyticktrade" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="9%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>channel_no</td>
<td>int</td>
<td>频道代码</td>
</tr>
<tr class="row-odd"><td>seq</td>
<td>int</td>
<td>委托序号(在同一个channel_no内唯一，从1开始连续)</td>
</tr>
<tr class="row-even"><td>price</td>
<td>int</td>
<td>委托价格</td>
</tr>
<tr class="row-odd"><td>qty</td>
<td>int</td>
<td>委托数量</td>
</tr>
<tr class="row-even"><td>money</td>
<td>int</td>
<td>成交金额</td>
</tr>
<tr class="row-odd"><td>bid_no</td>
<td>int</td>
<td>买方订单号</td>
</tr>
<tr class="row-even"><td>ask_no</td>
<td>int</td>
<td>卖方订单号</td>
</tr>
<tr class="row-odd"><td>trade_flag</td>
<td>str</td>
<td>SH: 内外盘标识(‘B’:主动买; ‘S’:主动卖; ‘N’:未知)  SZ: 成交标识(‘4’:撤; ‘F’:成交)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="order">
<h3>Order<a class="headerlink" href="#order" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>strategy_id</td>
<td>str</td>
<td>策略id</td>
</tr>
<tr class="row-odd"><td>run_id</td>
<td>str</td>
<td>策略运行id，代表策略的一次运行对应的id，即回测/模拟/实盘id</td>
</tr>
<tr class="row-even"><td>order_id</td>
<td>str</td>
<td>后台系统生成的内部订单id</td>
</tr>
<tr class="row-odd"><td>cl_order_id</td>
<td>str</td>
<td>订单的客户方id</td>
</tr>
<tr class="row-even"><td>product_id</td>
<td>str</td>
<td>交易标的，格式为市场.证券ID/市场.合约ID</td>
</tr>
<tr class="row-odd"><td>account_id</td>
<td>str</td>
<td>用户资金账户id</td>
</tr>
<tr class="row-even"><td>account_type</td>
<td>int</td>
<td>用户资金账户类型，参考 <a class="reference internal" href="index.html#accounttype"><span class="std std-ref">AccountType</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>date</td>
<td>int</td>
<td>订单创建日期，格式：YYYYMMDD</td>
</tr>
<tr class="row-even"><td>trade_seqno</td>
<td>int</td>
<td>交易序号，即批次号</td>
</tr>
<tr class="row-odd"><td>order_status</td>
<td>int</td>
<td>订单状态，参考 <a class="reference internal" href="index.html#orderstatus"><span class="std std-ref">OrderStatus</span></a> 定义</td>
</tr>
<tr class="row-even"><td>order_type</td>
<td>int</td>
<td>订单类型，参考 <a class="reference internal" href="index.html#ordertype"><span class="std std-ref">OrderType</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>side</td>
<td>int</td>
<td>多/空，参考 <a class="reference internal" href="index.html#orderside"><span class="std std-ref">OrderSide</span></a> 定义</td>
</tr>
<tr class="row-even"><td>credit_type</td>
<td>int</td>
<td>信用类型，参考 <a class="reference internal" href="index.html#credittype"><span class="std std-ref">CreditType</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>volume</td>
<td>int</td>
<td>订单数量</td>
</tr>
<tr class="row-even"><td>price</td>
<td>float</td>
<td>订单委托价</td>
</tr>
<tr class="row-odd"><td>filled_volume</td>
<td>int</td>
<td>订单累计已完成数量</td>
</tr>
<tr class="row-even"><td>filled_turnover</td>
<td>float</td>
<td>订单累计已完成金额</td>
</tr>
<tr class="row-odd"><td>filled_price</td>
<td>float</td>
<td>成交均价</td>
</tr>
<tr class="row-even"><td>filled_market_value</td>
<td>float</td>
<td>成交合约价值</td>
</tr>
<tr class="row-odd"><td>margin_ratio</td>
<td>float</td>
<td>保证金比率</td>
</tr>
<tr class="row-even"><td>marketdata_time</td>
<td>int</td>
<td>触发订单的行情时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
<tr class="row-odd"><td>create_time</td>
<td>int</td>
<td>订单创建时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
<tr class="row-even"><td>update_time</td>
<td>int</td>
<td>订单更新时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
<tr class="row-odd"><td>finish_time</td>
<td>int</td>
<td>订单完成时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
<tr class="row-even"><td>cancel_flag</td>
<td>int</td>
<td>撤单标识，参考 <a class="reference internal" href="index.html#cancelflag"><span class="std std-ref">CancelFlag</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>cancel_volume</td>
<td>int</td>
<td>撤单量</td>
</tr>
<tr class="row-even"><td>cancel_cnt</td>
<td>int</td>
<td>撤单次数</td>
</tr>
<tr class="row-odd"><td>hedge_flag</td>
<td>int</td>
<td>组合投机套保标志，用于期货交易, 参考 <a class="reference internal" href="index.html#hedgeflag"><span class="std std-ref">HedgeFlag</span></a> 定义</td>
</tr>
<tr class="row-even"><td>comb_id</td>
<td>str</td>
<td>组合投机套保编号，用于期货交易</td>
</tr>
<tr class="row-odd"><td>plate</td>
<td>str</td>
<td>期权交易板块</td>
</tr>
<tr class="row-even"><td>err_code</td>
<td>int</td>
<td>订单委托错误码</td>
</tr>
<tr class="row-odd"><td>err_msg</td>
<td>str</td>
<td>订单委托错误消息</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="trade">
<h3>Trade<a class="headerlink" href="#trade" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>strategy_id</td>
<td>str</td>
<td>策略id</td>
</tr>
<tr class="row-odd"><td>run_id</td>
<td>str</td>
<td>策略运行id，代表策略的一次运行对应的id，即回测/模拟/实盘id</td>
</tr>
<tr class="row-even"><td>order_id</td>
<td>str</td>
<td>后台系统生成的内部订单id</td>
</tr>
<tr class="row-odd"><td>cl_order_id</td>
<td>str</td>
<td>订单的客户方id</td>
</tr>
<tr class="row-even"><td>product_id</td>
<td>str</td>
<td>交易标的，格式为市场.证券ID/市场.合约ID</td>
</tr>
<tr class="row-odd"><td>account_id</td>
<td>str</td>
<td>用户资金账户id</td>
</tr>
<tr class="row-even"><td>account_type</td>
<td>int</td>
<td>用户资金账户类型，参考 <a class="reference internal" href="index.html#accounttype"><span class="std std-ref">AccountType</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>date</td>
<td>int</td>
<td>订单创建日期，格式：YYYYMMDD</td>
</tr>
<tr class="row-even"><td>trade_seqno</td>
<td>int</td>
<td>交易序号，即批次号</td>
</tr>
<tr class="row-odd"><td>side</td>
<td>int</td>
<td>多/空，参考 <a class="reference internal" href="index.html#orderside"><span class="std std-ref">OrderSide</span></a> 定义</td>
</tr>
<tr class="row-even"><td>order_type</td>
<td>int</td>
<td>订单类型，参考 <a class="reference internal" href="index.html#ordertype"><span class="std std-ref">OrderType</span></a> 定义</td>
</tr>
<tr class="row-odd"><td>exec_type</td>
<td>int</td>
<td>成交回报类型，参考 <a class="reference internal" href="index.html#tradereporttype"><span class="std std-ref">TradeReportType</span></a> 定义</td>
</tr>
<tr class="row-even"><td>volume</td>
<td>int</td>
<td>成交数量</td>
</tr>
<tr class="row-odd"><td>price</td>
<td>float</td>
<td>成交价格</td>
</tr>
<tr class="row-even"><td>turnover</td>
<td>float</td>
<td>成交金额</td>
</tr>
<tr class="row-odd"><td>market_value</td>
<td>float</td>
<td>成交合约市值</td>
</tr>
<tr class="row-even"><td>order_price</td>
<td>float</td>
<td>委托价格</td>
</tr>
<tr class="row-odd"><td>order_volume</td>
<td>int</td>
<td>委托数量</td>
</tr>
<tr class="row-even"><td>transact_time</td>
<td>int</td>
<td>成交时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="position">
<h3>Position<a class="headerlink" href="#position" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="12%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>strategy_id</td>
<td>str</td>
<td>策略id</td>
</tr>
<tr class="row-odd"><td>run_id</td>
<td>str</td>
<td>策略运行id，代表策略的一次运行对应的id，即回测/模拟/实盘id</td>
</tr>
<tr class="row-even"><td>account_id</td>
<td>str</td>
<td>用户资金账户id</td>
</tr>
<tr class="row-odd"><td>account_type</td>
<td>int</td>
<td>用户资金账户类型，参考 <a class="reference internal" href="index.html#accounttype"><span class="std std-ref">AccountType</span></a> 定义</td>
</tr>
<tr class="row-even"><td>product_id</td>
<td>str</td>
<td>交易标的，格式为市场.证券ID/市场.合约ID</td>
</tr>
<tr class="row-odd"><td>side</td>
<td>int</td>
<td>持仓方向，参考 <a class="reference internal" href="index.html#positionside"><span class="std std-ref">PositionSide</span></a> 定义</td>
</tr>
<tr class="row-even"><td>volume</td>
<td>int</td>
<td>总仓量</td>
</tr>
<tr class="row-odd"><td>avail_volume</td>
<td>int</td>
<td>可用仓量</td>
</tr>
<tr class="row-even"><td>frozen_volume</td>
<td>int</td>
<td>冻结仓量</td>
</tr>
<tr class="row-odd"><td>today_volume</td>
<td>int</td>
<td>今仓总量</td>
</tr>
<tr class="row-even"><td>today_frozen_volume</td>
<td>int</td>
<td>今仓冻结量</td>
</tr>
<tr class="row-odd"><td>today_avail_volume</td>
<td>int</td>
<td>今仓可用量</td>
</tr>
<tr class="row-even"><td>yesterday_volume</td>
<td>int</td>
<td>昨仓总量</td>
</tr>
<tr class="row-odd"><td>yesterday_frozen_volume</td>
<td>int</td>
<td>昨仓冻结量</td>
</tr>
<tr class="row-even"><td>yesterday_avail_volume</td>
<td>int</td>
<td>昨仓可用量</td>
</tr>
<tr class="row-odd"><td>avg_cost</td>
<td>float</td>
<td>开仓均价</td>
</tr>
<tr class="row-even"><td>hold_cost</td>
<td>float</td>
<td>持仓均价</td>
</tr>
<tr class="row-odd"><td>create_day</td>
<td>int</td>
<td>初始建仓日期，格式：YYYYMMDD</td>
</tr>
<tr class="row-even"><td>update_day</td>
<td>int</td>
<td>仓位变更日期，格式：YYYYMMDD</td>
</tr>
<tr class="row-odd"><td>create_time</td>
<td>int</td>
<td>初始建仓时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
<tr class="row-even"><td>update_time</td>
<td>int</td>
<td>仓位变更时间，精确到微秒，格式HHMMSSmmmuuu</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="canceldetail">
<h3>CancelDetail<a class="headerlink" href="#canceldetail" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="20%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">字段名</th>
<th class="head">类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>order_id</td>
<td>str</td>
<td>后台系统生成的内部订单id</td>
</tr>
<tr class="row-odd"><td>cancel_order_id</td>
<td>str</td>
<td>订单对应的撤单委托id</td>
</tr>
<tr class="row-even"><td>err_code</td>
<td>int</td>
<td>撤单错误码</td>
</tr>
<tr class="row-odd"><td>err_msg</td>
<td>str</td>
<td>撤单错误消息</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-api/sparkquant"></span><div class="section" id="api">
<h2>API介绍<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-api/scheduler"></span><div class="section" id="module-sparkquant.api.td_api">
<span id="id1"></span><span id="api-scheduler"></span><h3>定时器<a class="headerlink" href="#module-sparkquant.api.td_api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="schedule">
<h4>schedule - 设定定时任务<a class="headerlink" href="#schedule" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.td_api.schedule">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">schedule</code><span class="sig-paren">(</span><em>func</em>, <em>timer_type</em>, <em>interval=0</em>, <em>time=0</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.schedule" title="Permalink to this definition">¶</a></dt>
<dd><p>设定定时任务。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>func</strong> – 定时运行函数。其参数为 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a>。</li>
<li><strong>timer_type</strong> (<em>str</em>) – 定时器类型。目前仅支持‘timer’和‘day’：设定一个时间间隔的定时任务使用‘timer’，
设定每日某个时间点的定时任务使用‘day’。</li>
<li><strong>interval</strong> (<em>int</em>) – 定时器的时间间隔，单位为毫秒（ms），仅timer_type指定为‘timer’时有效。</li>
<li><strong>time</strong> (<em>int</em>) – 每日定时任务执行时间，格式为HHMMSS，仅timer_type指定为‘day’时有效。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#每2秒钟执行strategy_timer函数</span>
<span class="n">schedule</span><span class="p">(</span><span class="n">strategy_timer</span><span class="p">,</span> <span class="n">timer_type</span><span class="o">=</span><span class="s1">&#39;timer&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1">#每天的08:57:00执行strategy_day函数</span>
<span class="n">schedule</span><span class="p">(</span><span class="n">strategy_day_85700</span><span class="p">,</span> <span class="n">timer_type</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">85700</span><span class="p">)</span>

<span class="c1">#每天的09:35:00执行strategy_day函数</span>
<span class="n">schedule</span><span class="p">(</span><span class="n">strategy_day_93500</span><span class="p">,</span> <span class="n">timer_type</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">93500</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strategy_timer</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;timer_schedule&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strategy_day_85700</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;day_schedule_85700&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strategy_day_93500</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;day_schedule_93500&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="unschedule">
<h4>unschedule - 取消定时任务<a class="headerlink" href="#unschedule" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.td_api.unschedule">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">unschedule</code><span class="sig-paren">(</span><em>timer_type</em>, <em>interval=0</em>, <em>time=0</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.unschedule" title="Permalink to this definition">¶</a></dt>
<dd><p>取消定时任务。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timer_type</strong> (<em>str</em>) – 定时器类型。目前仅支持‘timer’和‘day’：取消一个时间间隔的定时任务使用‘timer’，
取消每日某个时间点的定时任务使用‘day’。</li>
<li><strong>interval</strong> (<em>int</em>) – 待取消的定时器的时间间隔，单位为毫秒（ms），仅timer_type指定为‘timer’时有效。</li>
<li><strong>time</strong> (<em>int</em>) – 待取消的每日定时任务执行时间，格式为HHMMSS，仅timer_type指定为‘day’时有效。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#取消2秒钟的定时任务</span>
<span class="n">unschedule</span><span class="p">(</span><span class="n">timer_type</span><span class="o">=</span><span class="s1">&#39;timer&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1">#取消每天08:57:00的定时任务</span>
<span class="n">unschedule</span><span class="p">(</span><span class="n">timer_type</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">85700</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<span id="document-api/strategyapi"></span><div class="section" id="id1">
<h3>策略接口<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="module-sparkquant.strategy.strategy_context">
<span id="context"></span><h4>context - 策略上下文<a class="headerlink" href="#module-sparkquant.strategy.strategy_context" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="sparkquant.strategy.strategy_context.StrategyContext">
<em class="property">class </em><code class="descclassname">sparkquant.strategy.strategy_context.</code><code class="descname">StrategyContext</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext" title="Permalink to this definition">¶</a></dt>
<dd><p>策略上下文。
负责管理当前运行策略的上下文信息，包括手续费，滑点，资产组合等信息。</p>
<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.cash">
<em class="property">static </em><code class="descname">cash</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.cash" title="Permalink to this definition">¶</a></dt>
<dd><p>查询策略资金。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None or list[dict] 策略资金账户数据列表或总资金。若出现错误，录入错误日志后返回None。</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">cash属性</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>account_id</td>
<td>用户资金账户id</td>
</tr>
<tr class="row-odd"><td>account_type</td>
<td>用户资金账户类型，参考 <a class="reference internal" href="index.html#accounttype"><span class="std std-ref">AccountType</span></a> 定义</td>
</tr>
<tr class="row-even"><td>start_cash</td>
<td>初始资金</td>
</tr>
<tr class="row-odd"><td>cash</td>
<td>当前资金</td>
</tr>
<tr class="row-even"><td>avail_cash</td>
<td>可用资金</td>
</tr>
<tr class="row-odd"><td>locked_cash</td>
<td>冻结资金</td>
</tr>
<tr class="row-even"><td>turnover</td>
<td>累计交易额</td>
</tr>
<tr class="row-odd"><td>today_turnover</td>
<td>今日交易额</td>
</tr>
<tr class="row-even"><td>today_close_value</td>
<td>今日卖出券获取的资金额</td>
</tr>
<tr class="row-odd"><td>update_time</td>
<td>帐户更新时间戳</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#获取资金账号信息</span>
<span class="n">context</span><span class="o">.</span><span class="n">cash</span><span class="p">()</span>

<span class="c1">#返回结果</span>
<span class="p">[{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;strategy_id&#39;</span><span class="p">:</span> <span class="s1">&#39;X-01-20181105091236-00000006&#39;</span><span class="p">,</span>
  <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="s1">&#39;B-00-20181226090202-11764248&#39;</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;account_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">AccountType</span><span class="o">.</span><span class="n">Stock</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PositionSide</span><span class="o">.</span><span class="n">Long</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;frozen_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="s1">&#39;today_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;today_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;today_avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yesterday_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;yesterday_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yesterday_avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;avg_cost&#39;</span><span class="p">:</span> <span class="mf">24.47</span><span class="p">,</span> <span class="s1">&#39;hold_cost&#39;</span><span class="p">:</span> <span class="mf">24.47</span><span class="p">,</span>
  <span class="s1">&#39;create_day&#39;</span><span class="p">:</span> <span class="mi">20181105</span><span class="p">,</span> <span class="s1">&#39;update_day&#39;</span><span class="p">:</span> <span class="mi">20181105</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">93000100000</span><span class="p">,</span> <span class="s1">&#39;update_time&#39;</span><span class="p">:</span> <span class="mi">93000100000</span><span class="p">,</span>
  <span class="s1">&#39;error_no&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.log_level">
<code class="descname">log_level</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.log_level" title="Permalink to this definition">¶</a></dt>
<dd><p>获取日志级别，1: Debug, 2: Info, 3: Warn, 4: Error</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">int 日志级别</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.now">
<code class="descname">now</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.now" title="Permalink to this definition">¶</a></dt>
<dd><p>获取当前日期和时间: 对于回测模式 - 返回回测执行当前日期时间，对于实盘和模拟模式返回当前机器的系统时间。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">datetime.datetime 当前日期和时间</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 获取当前日期时间</span>
<span class="n">context</span><span class="o">.</span><span class="n">now</span>

<span class="c1"># 返回结果</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">05</span> <span class="mi">11</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mf">09.200000</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.order">
<em class="property">static </em><code class="descname">order</code><span class="sig-paren">(</span><em>order_id</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.order" title="Permalink to this definition">¶</a></dt>
<dd><p>查询单一订单详情</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>order_id</strong> – 后台生成的订单id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">对应订单详情，请参考 <a class="reference internal" href="index.html#order"><span class="std std-ref">Order</span></a> 定义</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#查询id为&#39;01201809101108120000001257&#39;的报单详细信息</span>
<span class="n">context</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;01201809101108120000001257&#39;</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="p">{</span><span class="s1">&#39;filled_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;filled_turnover&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;order_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">OrderType</span><span class="o">.</span><span class="n">LimitOrder</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;err_code&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;finish_time&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;comb_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;marketdata_time&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trade_seqno&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="s1">&#39;S-73141333510000-4530-82000000&#39;</span><span class="p">,</span>
     <span class="s1">&#39;margin_ratio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err_msg&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;strategy_id&#39;</span><span class="p">:</span> <span class="s1">&#39;X-96620333510000-6795-02000000&#39;</span><span class="p">,</span>
     <span class="s1">&#39;cancel_cnt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;account_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">AccountType</span><span class="o">.</span><span class="n">Stock</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;order_status&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">110812911715</span><span class="p">,</span>
     <span class="s1">&#39;cl_order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mf">23.0</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="mi">20180910</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;credit_type&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;01201809101108120000001257&#39;</span><span class="p">,</span> <span class="s1">&#39;plate&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;filled_market_value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PositionSide</span><span class="o">.</span><span class="n">Long</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;hedge_flag&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">HedgeFlag</span><span class="o">.</span><span class="n">Non</span><span class="p">:</span> <span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;error_no&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;update_time&#39;</span><span class="p">:</span> <span class="mi">110813029910</span><span class="p">,</span>
       <span class="s1">&#39;filled_price&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;cancel_flag&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cancel_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.orders">
<em class="property">static </em><code class="descname">orders</code><span class="sig-paren">(</span><em>page_num</em>, <em>page_size</em>, <em>start_date=''</em>, <em>end_date=''</em>, <em>total_size=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.orders" title="Permalink to this definition">¶</a></dt>
<dd><p>查策略实例订单列表，支持分页查询。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>page_num</strong> – page_num表示此次分页请求从哪一页开始，第一页page_num为1。</li>
<li><strong>page_size</strong> – 输入时：分页个数，输出时：实际返回的订单个数
<strong>*注意：返回个数小于输入的分页个数时，表示数据已经全部读取完毕*</strong>。</li>
<li><strong>start_date</strong> – 查询开始日期,如果为空或NULL，则为当前交易日，格式为2018/3/1。</li>
<li><strong>end_date</strong> – 查询结束日期,如果为空或NULL，则为当前交易日，格式为2018/3/1。
end_date必须大于等于start_date，可以只传start_date，不可以只传end_date</li>
<li><strong>total_size</strong> – 返回的订单列表总条数，若不传入，则不返回。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">所有符合指定条件的订单的详细信息。报单信息请参考 <a class="reference internal" href="index.html#order"><span class="std std-ref">Order</span></a> 定义</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#查询当天前2条报单的详细信息，返回报单列表</span>
<span class="n">context</span><span class="o">.</span><span class="n">orders</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.position">
<em class="property">static </em><code class="descname">position</code><span class="sig-paren">(</span><em>symbol</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.position" title="Permalink to this definition">¶</a></dt>
<dd><p>查询单个标的证券的持仓列表。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>symbol</strong> (<em>str</em>) – 单个标的代码。</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None or list[ <a class="reference internal" href="index.html#position"><span class="std std-ref">Position</span></a> ] 单个标的持仓列表。若出现错误，录入错误日志后返回None。</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#获取股票万科A的持仓信息</span>
<span class="n">context</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="s1">&#39;SZ.000002&#39;</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="p">[{</span><span class="s1">&#39;yesterday_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;account_type&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;today_avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;frozen_volume&#39;</span><span class="p">:</span> <span class="mi">2100</span><span class="p">,</span>
  <span class="s1">&#39;update_time&#39;</span><span class="p">:</span> <span class="mi">110812911715</span><span class="p">,</span> <span class="s1">&#39;error_no&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="s1">&#39;S-73141333510000-4530-82000000&#39;</span><span class="p">,</span>
  <span class="s1">&#39;avail_volume&#39;</span><span class="p">:</span> <span class="mi">464500</span><span class="p">,</span> <span class="s1">&#39;create_day&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strategy_id&#39;</span><span class="p">:</span> <span class="s1">&#39;X-96620333510000-6795-02000000&#39;</span><span class="p">,</span>
  <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PositionSide</span><span class="o">.</span><span class="n">Long</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;today_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mi">466600</span><span class="p">,</span> <span class="s1">&#39;hold_cost&#39;</span><span class="p">:</span> <span class="mf">21.4268</span><span class="p">,</span> <span class="s1">&#39;update_day&#39;</span><span class="p">:</span> <span class="mi">20180910</span><span class="p">,</span>
  <span class="s1">&#39;avg_cost&#39;</span><span class="p">:</span> <span class="mf">21.0799</span><span class="p">,</span> <span class="s1">&#39;yesterday_volume&#39;</span><span class="p">:</span> <span class="mi">341900</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yesterday_avail_volume&#39;</span><span class="p">:</span> <span class="mi">341900</span><span class="p">,</span>
  <span class="s1">&#39;today_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="s1">&#39;6814&#39;</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.positions">
<em class="property">static </em><code class="descname">positions</code><span class="sig-paren">(</span><em>symbols=None</em>, <em>start_date=''</em>, <em>end_date=''</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.positions" title="Permalink to this definition">¶</a></dt>
<dd><p>查询策略持仓列表。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbols</strong> (<em>str/list</em>) – 多个标的代码，默认为None，即获取所有可获得的持仓数据。</li>
<li><strong>start_date</strong> (<em>str</em>) – 查询开始日期,如果为空或NULL，则为当前交易日，格式为2018/3/1。</li>
<li><strong>end_date</strong> (<em>str</em>) – 查询结束日期,如果为空或NULL，则为当前交易日，格式为2018/3/1。
end_date必须大于等于start_date，可以只传start_date，不可以只传end_date</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">None or list[ <a class="reference internal" href="index.html#position"><span class="std std-ref">Position</span></a> ] 多个标的持仓列表。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 查询当天持仓的详细信息</span>
<span class="n">context</span><span class="o">.</span><span class="n">positions</span><span class="p">()</span>

<span class="c1"># 返回结果，每个持仓的具体信息参考position()函数</span>
<span class="p">[{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;strategy_id&#39;</span><span class="p">:</span> <span class="s1">&#39;X-01-20181105091236-00000006&#39;</span><span class="p">,</span>
  <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="s1">&#39;B-00-20181226090202-11764248&#39;</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;account_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">AccountType</span><span class="o">.</span><span class="n">Stock</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PositionSide</span><span class="o">.</span><span class="n">Long</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;frozen_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="s1">&#39;today_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;today_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;today_avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yesterday_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">&#39;yesterday_frozen_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;yesterday_avail_volume&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;avg_cost&#39;</span><span class="p">:</span> <span class="mf">24.47</span><span class="p">,</span> <span class="s1">&#39;hold_cost&#39;</span><span class="p">:</span> <span class="mf">24.47</span><span class="p">,</span>
  <span class="s1">&#39;create_day&#39;</span><span class="p">:</span> <span class="mi">20181105</span><span class="p">,</span> <span class="s1">&#39;update_day&#39;</span><span class="p">:</span> <span class="mi">20181105</span><span class="p">,</span> <span class="s1">&#39;create_time&#39;</span><span class="p">:</span> <span class="mi">93000100000</span><span class="p">,</span>
  <span class="s1">&#39;update_time&#39;</span><span class="p">:</span> <span class="mi">93000100000</span><span class="p">,</span> <span class="s1">&#39;error_no&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SH.600011&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">}]</span>

<span class="c1"># 查询当天指定标的持仓信息</span>
<span class="n">context</span><span class="o">.</span><span class="n">positions</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">])</span>

<span class="c1"># 返回结果，每个持仓的具体信息参考position()函数</span>
<span class="p">[{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.run_id">
<code class="descname">run_id</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.run_id" title="Permalink to this definition">¶</a></dt>
<dd><p>获取策略运行实例id</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">str 策略运行实例id</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.run_mode">
<code class="descname">run_mode</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.run_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>获取运行模式，1：回测，2：模拟，3：实盘</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">int 运行模式</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.strategy_id">
<code class="descname">strategy_id</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.strategy_id" title="Permalink to this definition">¶</a></dt>
<dd><p>获取策略id</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">str 策略id</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.sys_account_id">
<code class="descname">sys_account_id</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.sys_account_id" title="Permalink to this definition">¶</a></dt>
<dd><p>获取系统账号</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">str 系统账号</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.trades">
<em class="property">static </em><code class="descname">trades</code><span class="sig-paren">(</span><em>order_id</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.trades" title="Permalink to this definition">¶</a></dt>
<dd><p>查单个订单成交列表。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>order_id</strong> (<em>str</em>) – 后台系统生成的订单id。</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None or list[ <a class="reference internal" href="index.html#trade"><span class="std std-ref">Trade</span></a> ]成交列表。</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 查询指定订单号的成交的详细信息，返回成交列表</span>
<span class="n">context</span><span class="o">.</span><span class="n">trades</span><span class="p">(</span><span class="s1">&#39;181105_1438_0_2_34157056&#39;</span><span class="p">)</span>

<span class="c1"># 返回结果</span>
<span class="p">[{</span><span class="s1">&#39;strategy_id&#39;</span><span class="p">:</span> <span class="s1">&#39;X-01-20181105091236-00000006&#39;</span><span class="p">,</span> <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="s1">&#39;B-00-20181226141425-34157056&#39;</span><span class="p">,</span>
 <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;181105_1438_0_2_34157056&#39;</span><span class="p">,</span> <span class="s1">&#39;cl_order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="s1">&#39;6814&#39;</span><span class="p">,</span>
 <span class="s1">&#39;account_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">AccountType</span><span class="o">.</span><span class="n">All</span><span class="p">:</span> <span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="mi">20181105</span><span class="p">,</span> <span class="s1">&#39;trade_seqno&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PositionSide</span><span class="o">.</span><span class="n">Long</span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;order_type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">OrderType</span><span class="o">.</span><span class="n">MarketOrder_B5TC</span><span class="p">:</span> <span class="mi">4</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;exec_type&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mf">24.47</span><span class="p">,</span>
 <span class="s1">&#39;turnover&#39;</span><span class="p">:</span> <span class="mf">2447.0</span><span class="p">,</span> <span class="s1">&#39;market_value&#39;</span><span class="p">:</span> <span class="mf">2447.0</span><span class="p">,</span> <span class="s1">&#39;order_price&#39;</span><span class="p">:</span> <span class="mf">24.48</span><span class="p">,</span> <span class="s1">&#39;order_volume&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s1">&#39;transact_time&#39;</span><span class="p">:</span> <span class="mi">93000100000</span><span class="p">,</span> <span class="s1">&#39;error_no&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="attribute">
<dt id="sparkquant.strategy.strategy_context.StrategyContext.universe">
<code class="descname">universe</code><a class="headerlink" href="#sparkquant.strategy.strategy_context.StrategyContext.universe" title="Permalink to this definition">¶</a></dt>
<dd><p>获取所有当前订阅的合约代码</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list[str] 当前订阅的所有合约代码</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 订阅合约</span>
<span class="n">subscribe</span><span class="p">([</span><span class="s1">&#39;SZ.000002.tick&#39;</span><span class="p">,</span> <span class="s1">&#39;CFFEX.IF1812.tick&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000.bar&#39;</span><span class="p">])</span>

<span class="c1"># 获取所有订阅的合约代码</span>
<span class="n">context</span><span class="o">.</span><span class="n">universe</span>

<span class="c1"># 返回结果</span>
<span class="p">[</span><span class="s1">&#39;SZ.000002.tick&#39;</span><span class="p">,</span> <span class="s1">&#39;CFFEX.IF1812.tick&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000.bar&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-sparkquant.main">
<span id="run"></span><h4>run - 启动策略<a class="headerlink" href="#module-sparkquant.main" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.main.run">
<code class="descclassname">sparkquant.main.</code><code class="descname">run</code><span class="sig-paren">(</span><em>init</em>, <em>on_bar=None</em>, <em>on_tick=None</em>, <em>on_order_response=None</em>, <em>on_order_status=None</em>, <em>on_execution_report=None</em>, <em>on_cancel_order=None</em>, <em>on_set_params=None</em>, <em>config_dir=''</em>, <em>log_dir=''</em>, <em>is_async=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.main.run" title="Permalink to this definition">¶</a></dt>
<dd><p>初始化并运行策略，以及在异步模式下处理用户的退出策略请求。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>init</strong> (<em>func</em>) – <p>用户自定义的初始化函数，策略启动时会被调用。<a class="reference internal" href="#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 是其唯一参数。函数声明如下：</p>
<p><code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">init(context):</span></code></p>
</li>
<li><strong>on_bar</strong> (<em>func</em>) – 请参考 <a class="reference internal" href="index.html#on-tick-tick"><span class="std std-ref">on_tick - 返回Tick数据</span></a></li>
<li><strong>on_tick</strong> (<em>func</em>) – 请参考 <a class="reference internal" href="index.html#on-bar-bar"><span class="std std-ref">on_bar - 返回Bar数据</span></a></li>
<li><strong>on_order_response</strong> (<em>func</em>) – 有待补充…</li>
<li><strong>on_order_status</strong> (<em>func</em>) – 请参考 <a class="reference internal" href="index.html#on-order-status"><span class="std std-ref">on_order_status - 返回报单状态</span></a></li>
<li><strong>on_execution_report</strong> (<em>func</em>) – 请参考 <a class="reference internal" href="index.html#on-execution-report"><span class="std std-ref">on_execution_report - 返回成交回报</span></a></li>
<li><strong>on_cancel_order</strong> (<em>func</em>) – 有待补充…</li>
<li><strong>on_set_params</strong> (<em>func</em>) – 请参考 <a class="reference internal" href="index.html#on-set-params"><span class="std std-ref">on_set_params - 返回策略参数修改回报</span></a></li>
<li><strong>config_dir</strong> (<em>str</em>) – 策略配置文件目录，默认是当前可执行程序目录</li>
<li><strong>log_dir</strong> (<em>str</em>) – 策略日志文件目录，默认是当前可执行程序目录</li>
<li><strong>is_async</strong> (<em>bool</em>) – 运行模式（异步/同步）。
True：异步运行。后台将启动一个新线程执行事件循环，除了运行结束或者异常终止可以引起策略退出之外，
用户还可以采用键入’q’+Enter的方式终止正在运行中的策略。
False: 同步运行。由主线程执行事件循环，直到策略运行结束或者异常终止。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">无</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<span id="document-api/mdapi"></span><span class="target" id="module-sparkquant.api.md_api"></span><div class="section" id="api-mdapi-sub">
<span id="id1"></span><h3>数据订阅<a class="headerlink" href="#api-mdapi-sub" title="Permalink to this headline">¶</a></h3>
<div class="section" id="subscribe">
<h4>subscribe - 订阅行情<a class="headerlink" href="#subscribe" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.subscribe">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">subscribe</code><span class="sig-paren">(</span><em>symbols</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>订阅行情，目前支持的类型包括：tick/bar/index/zw/zc，分别表示tick数据/k线数据/指数tick数据/逐笔委托/逐笔成交。
其中tick/index/zw/zc会通过on_tick函数进行推送，bar会通过on_bar函数进行推送。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>symbols</strong> (<em>str/list</em>) – 订阅标的代码，例如”SH.601211.tick, SZ.000002.bar”或[“SH.601211.tick”, “SZ.000002.bar”]。</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">int error_no: 成功返回0，失败返回错误码</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#同时订阅万科A股票的tick行情，股指期货1812的分钟线行情，上证指数的tick行情和万科A股票的逐笔委托及逐笔成交。</span>
<span class="n">context</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SZ.000002.bar&#39;</span><span class="p">,</span> <span class="s1">&#39;CFFEX.IF1812.bar&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.000001.index&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002.ZW&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002.ZC&#39;</span><span class="p">]</span>
<span class="n">subscribe</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<div class="section" id="api-mdapi-query">
<span id="id2"></span><h3>数据查询<a class="headerlink" href="#api-mdapi-query" title="Permalink to this headline">¶</a></h3>
<div class="section" id="history">
<h4>history - 查询历史行情<a class="headerlink" href="#history" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.history">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">history</code><span class="sig-paren">(</span><em>symbols</em>, <em>frequency</em>, <em>start_time</em>, <em>end_time=''</em>, <em>fields=None</em>, <em>adjust=&lt;Adjust.Pre: 'before'&gt;</em>, <em>ndarray_format=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.history" title="Permalink to this definition">¶</a></dt>
<dd><p>查询历史行情。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbols</strong> (<em>str/list</em>) – 带交易所的证券代码列表，例如”SH.600726, SZ.000729”, 或者[“SH.600726”, “SZ.000729”]。</li>
<li><strong>frequency</strong> (<em>str</em>) – 计算频率为tick,min和day。如果不指定频率周期，则默认为1，
比如”tick”, “min”, “day”则分别等价于”1tick”, “1min”, “1day”。
注意tick数据目前只支持1tick，min和day可以支持任意周期频率，比如”3min”, “2day”等。</li>
<li><strong>start_time</strong> (<em>str/date/datetime</em>) – 开始时间，字符串格式为（”YYYY/MM/DD HH:MM:SS”），例如”2017/07/05 09:00:00”</li>
<li><strong>end_time</strong> (<em>str/date/datetime</em>) – 结束时间，字符串格式为（”YYYY/MM/DD HH:MM:SS”），例如”2017/07/05 10:00:00”。
若未指定则默认使用当前时间作为结束时间。当基于分钟K线计算时日期跨度不能大于1年，基于日线计算则不受限制。</li>
<li><strong>fields</strong> (<em>list</em>) – 指定返回对象字段，例如[“open”, “close”, “volume”]，若指定的字段不存在，则默认以空字符串或0值填充。
具体存在哪些字段，请参考 <a class="reference internal" href="index.html#securitybardata"><span class="std std-ref">SecurityBarData</span></a>， <a class="reference internal" href="index.html#securitytickdata"><span class="std std-ref">SecurityTickData</span></a>，<a class="reference internal" href="index.html#futurestickdata"><span class="std std-ref">FuturesTickData</span></a>，
<a class="reference internal" href="index.html#indextickdata"><span class="std std-ref">IndexTickData</span></a>，等。
若未指定则默认按如下顺序返回指定标准字段：
SecurityBarData： [‘date’, ‘time’, ‘open’, ‘high’, ‘low’, ‘close’, ‘volume’, ‘turnover’],
SecurityTickData: [‘time’, ‘open’, ‘high’, ‘low’, ‘match’, ‘volume’, ‘turnover’]
FuturesTickData: 待定
IndexTickData: 待定</li>
<li><strong>adjust</strong> (<em>Adjust</em>) – 复权方式，默认前复权，对tick数据无意义。 可选的复权方式请参考 <a class="reference internal" href="index.html#adjust"><span class="std std-ref">Adjust</span></a></li>
<li><strong>ndarray_format</strong> (<em>bool</em>) – True 返回的字典中值为ndarray, False 返回的字典中值为列表</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">None or dict(symbol, list(list)) 包含行情list的dict。若出现错误，录入错误日志后返回None。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">history</span><span class="p">([</span><span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">],</span> <span class="s2">&quot;1tick&quot;</span><span class="p">,</span> <span class="s2">&quot;2018/08/06 10:0:0&quot;</span><span class="p">,</span>
         <span class="s2">&quot;2018/08/06 10:0:05&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">ndarray_format</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="sd">&#39;&#39;&#39;返回结果如下：</span>
<span class="sd">    {&#39;SZ.000002&#39;: [[100000000, 21.18, 21.22, 20.52],</span>
<span class="sd">                   [100003000, 21.18, 21.22, 20.52]],</span>
<span class="sd">     &#39;SH.600000&#39;: [[100002000, 9.97, 10.02, 9.88],</span>
<span class="sd">                   [100005000, 9.97, 10.02, 9.88]]}</span>
<span class="sd"> &#39;&#39;&#39;</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="history-n-n">
<h4>history_n - 查询最新n条历史行情<a class="headerlink" href="#history-n-n" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.history_n">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">history_n</code><span class="sig-paren">(</span><em>symbols</em>, <em>frequency</em>, <em>count</em>, <em>end_time=''</em>, <em>fields=None</em>, <em>adjust=&lt;Adjust.Pre: 'before'&gt;</em>, <em>ndarray_format=True</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.history_n" title="Permalink to this definition">¶</a></dt>
<dd><p>查询指定时刻前的最新n条历史行情。注意，tick历史行情仅支持获取当日当前时刻最新的N笔证券ticks数据（会自动忽略end_time参数）。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbols</strong> (<em>str/list</em>) – 带交易所的证券代码列表，例如”SH.600726, SZ.000729”, 或者[“SH.600726”, “SZ.000729”]。</li>
<li><strong>frequency</strong> (<em>str</em>) – 计算频率为tick,min和day。如果不指定频率周期，则默认为1，
比如”tick”, “min”, “day”则分别等价于”1tick”, “1min”, “1day”。
注意tick数据目前只支持1tick，min和day可以支持任意周期频率，
比如”3min”, “2day”等。</li>
<li><strong>count</strong> (<em>int</em>) – 数据条数（正整数）。</li>
<li><strong>end_time</strong> (<em>str/date/datetime</em>) – 结束时间，字符串格式为（”YYYY/MM/DD HH:MM:SS”），例如”2017/07/05 10:00:00”。
若未指定则默认使用当前时间作为结束时间。注意：tick历史行情将忽略此字段。</li>
<li><strong>fields</strong> (<em>list</em>) – 指定返回对象字段，例如[“open”, “close”, “volume”]，未指定则返回所有的字段。
若指定的字段不存在，则默认以空字符串或0值填充。具体存在哪些字段，请参考 <a class="reference internal" href="index.html#securitytickdata"><span class="std std-ref">SecurityTickData</span></a>，
<a class="reference internal" href="index.html#futurestickdata"><span class="std std-ref">FuturesTickData</span></a>， <a class="reference internal" href="index.html#indextickdata"><span class="std std-ref">IndexTickData</span></a>， <a class="reference internal" href="index.html#securitybardata"><span class="std std-ref">SecurityBarData</span></a> 等。
若未指定则默认按如下顺序返回指定标准字段：
SecurityBarData： [‘date’, ‘time’, ‘open’, ‘high’, ‘low’, ‘close’, ‘volume’, ‘turnover’],
SecurityTickData: [‘time’, ‘open’, ‘high’, ‘low’, ‘match’, ‘volume’, ‘turnover’]
FuturesTickData: 待定
IndexTickData: 待定</li>
<li><strong>adjust</strong> (<em>Adjust</em>) – 复权方式，默认前复权，对tick数据无意义。可选的复权方式请参考 <a class="reference internal" href="index.html#adjust"><span class="std std-ref">Adjust</span></a></li>
<li><strong>ndarray_format</strong> (<em>bool</em>) – True 返回的字典中值为ndarray, False 返回的字典中值为列表</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">None or dict(symbol, list(list)) 包含行情list的dict。若出现错误，录入错误日志后返回None。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">history_n</span><span class="p">([</span><span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">],</span> <span class="s2">&quot;1day&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;2018/08/06 10:0:05&quot;</span><span class="p">,</span>
          <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">ndarray_format</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;返回结果如下：</span>
<span class="sd">{&#39;SZ.000002&#39;: [[20180806, 21.18, 21.32, 20.52],</span>
<span class="sd">               [20180803, 21.39, 21.54, 21.05],</span>
<span class="sd">               [20180802, 22.34, 22.34, 21.07]],</span>
<span class="sd"> &#39;SH.600000&#39;: [[20180806, 9.97, 10.03, 9.87],</span>
<span class="sd">               [20180803, 9.79, 9.98, 9.76],</span>
<span class="sd">               [20180802, 9.91, 10.03, 9.66]]}</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-trading-dates">
<h4>get_trading_dates - 获取交易日历<a class="headerlink" href="#get-trading-dates" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_trading_dates">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_trading_dates</code><span class="sig-paren">(</span><em>market</em>, <em>start_date</em>, <em>end_date</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_trading_dates" title="Permalink to this definition">¶</a></dt>
<dd><p>获取某个市场某段时间的交易日历数据</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>market</strong> (<em>MarketCode</em>) – 交易所代码,可选的交易所代码, 请参考 <a class="reference internal" href="index.html#marketcode"><span class="std std-ref">MarketCode</span></a></li>
<li><strong>start_date</strong> (<em>str/date/datetime</em>) – 开始日期，字符串格式如”2018/2/5”</li>
<li><strong>end_date</strong> (<em>str/date/datetime</em>) – 结束日期，字符串格式如”2018/2/10”</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">返回list，即在指定日期范围内指定市场的交易日列表</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#查询深交所2018/2/5（含）到2018/2/9(不含）之间的交易日列表</span>
<span class="n">get_trading_dates</span><span class="p">(</span><span class="n">MarketCode</span><span class="o">.</span><span class="n">SZ</span><span class="p">,</span><span class="s1">&#39;2018/2/5&#39;</span><span class="p">,</span><span class="s1">&#39;2018/2/9&#39;</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="c1">#[20180205, 20180206, 20180207, 20180208]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-instrument-info">
<h4>get_instrument_info - 查询合约基础信息<a class="headerlink" href="#get-instrument-info" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_instrument_info">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_instrument_info</code><span class="sig-paren">(</span><em>symbols</em>, <em>date=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_instrument_info" title="Permalink to this definition">¶</a></dt>
<dd><p>查询合约基础信息</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbols</strong> (<em>str</em>) – 证券代码，带交易所代码，如”SH.600000”</li>
<li><strong>date</strong> (<em>str/date/datetime</em>) – 指定的日期，比如”2017/1/3”，默认为None，表示当天</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">返回合约基本信息的dict</p>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">合约信息</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>证券代码（带交易所代码）</td>
</tr>
<tr class="row-odd"><td>sec_type</td>
<td>代码类型</td>
</tr>
<tr class="row-even"><td>sec_name</td>
<td>代码中文名称，编码为utf8</td>
</tr>
<tr class="row-odd"><td>date</td>
<td>日期 YYYYMMDD</td>
</tr>
<tr class="row-even"><td>high_limited</td>
<td>涨停价</td>
</tr>
<tr class="row-odd"><td>low_limited</td>
<td>跌停价</td>
</tr>
<tr class="row-even"><td>multiplier</td>
<td>合约乘数</td>
</tr>
<tr class="row-odd"><td>margin_ratio</td>
<td>保证金比率</td>
</tr>
<tr class="row-even"><td>price_tick</td>
<td>价格变更单位</td>
</tr>
<tr class="row-odd"><td>capital</td>
<td>流通股本数</td>
</tr>
<tr class="row-even"><td>cap_change_date</td>
<td>股本变动日期</td>
</tr>
<tr class="row-odd"><td>trade_date_in</td>
<td>上市日期YYYYMMDD</td>
</tr>
<tr class="row-even"><td>trade_date_out</td>
<td>退市日期YYYYMMDD(最后一个交易日)</td>
</tr>
<tr class="row-odd"><td>is_halt</td>
<td>是否停牌，1：停牌，0：正常交易</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 查询浦发银行的股票信息</span>
<span class="n">get_instrument_info</span><span class="p">(</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">)</span>
<span class="c1"># 返回结果</span>
<span class="c1"># {&#39;symbol&#39;: &#39;SH.600000&#39;, &#39;sec_type&#39;: 1, &#39;sec_name&#39;: &#39;浦发银行&#39;, &#39;date&#39;: 20180927, &#39;high_limited&#39;: 11.45,</span>
<span class="s1">&#39;low_limited&#39;</span><span class="p">:</span> <span class="mf">9.37</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;margin_ratio&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;price_tick&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="mi">28103760000</span><span class="p">,</span>
 <span class="s1">&#39;cap_change_date&#39;</span><span class="p">:</span> <span class="mi">20170904</span><span class="p">,</span> <span class="s1">&#39;trade_date_in&#39;</span><span class="p">:</span> <span class="mi">19991110</span><span class="p">,</span> <span class="s1">&#39;trade_date_out&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;is_halt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># 查询2018/2/14平安银行的股票信息</span>
<span class="n">get_instrument_info</span><span class="p">(</span><span class="s1">&#39;SZ.000001&#39;</span><span class="p">,</span> <span class="s1">&#39;2018/2/14&#39;</span><span class="p">)</span>
<span class="c1"># {&#39;symbol&#39;: &#39;SZ.000001&#39;, &#39;sec_type&#39;: 1, &#39;sec_name&#39;: &#39;平安银行&#39;, &#39;date&#39;: 20180214, &#39;high_limited&#39;: 13.13,</span>
<span class="s1">&#39;low_limited&#39;</span><span class="p">:</span> <span class="mf">10.75</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;margin_ratio&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;price_tick&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="mi">16917980000</span><span class="p">,</span>
<span class="s1">&#39;cap_change_date&#39;</span><span class="p">:</span> <span class="mi">20171231</span><span class="p">,</span> <span class="s1">&#39;trade_date_in&#39;</span><span class="p">:</span> <span class="mi">19910403</span><span class="p">,</span> <span class="s1">&#39;trade_date_out&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;is_halt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># 查询中金所IF1812的合约信息</span>
<span class="n">get_instrument_info</span><span class="p">(</span><span class="s1">&#39;CFFEX.IF1812&#39;</span><span class="p">)</span>
<span class="c1"># 返回结果</span>
<span class="c1"># {&#39;symbol&#39;: &#39;CFFEX.IF1812&#39;, &#39;sec_type&#39;: 2, &#39;sec_name&#39;: &#39;IF1812&#39;, &#39;date&#39;: 20180927, &#39;high_limited&#39;: 3761.4,</span>
<span class="s1">&#39;low_limited&#39;</span><span class="p">:</span> <span class="mf">3077.8</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;margin_ratio&#39;</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span> <span class="s1">&#39;price_tick&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s1">&#39;cap_change_date&#39;</span><span class="p">:</span> <span class="mi">20180423</span><span class="p">,</span> <span class="s1">&#39;trade_date_in&#39;</span><span class="p">:</span> <span class="mi">20180423</span><span class="p">,</span> <span class="s1">&#39;trade_date_out&#39;</span><span class="p">:</span> <span class="mi">20181221</span><span class="p">,</span> <span class="s1">&#39;is_halt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-instrument-list">
<h4>get_instrument_list - 查询成分股列表<a class="headerlink" href="#get-instrument-list" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_instrument_list">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_instrument_list</code><span class="sig-paren">(</span><em>code_table</em>, <em>date=None</em>, <em>show_detail=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_instrument_list" title="Permalink to this definition">¶</a></dt>
<dd><p>查询成分股列表，包含各种股票列表、基金列表、指数列表、债券列表、期货列表和期权列表</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>code_table</strong> (<em>CodeTable</em>) – 代码表名称，可选的代码表， 请参考 <a class="reference internal" href="index.html#codetable"><span class="std std-ref">CodeTable</span></a></li>
<li><strong>date</strong> (<em>str/date/datetime</em>) – 指定的日期，字符串如”2017/1/3”,默认为None,表示当天</li>
<li><strong>show_detail</strong> (<em>bool</em>) – 是否显示每个合约的明细信息，默认为False</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">显示明细信息时返回合约明细列表list(dict)，否则返回合约名称列表list</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 查询上交所当前合约列表</span>
<span class="n">get_instrument_list</span><span class="p">(</span><span class="n">CodeTable</span><span class="o">.</span><span class="n">SHAG</span><span class="p">)</span>

<span class="c1"># 查询2018/1/1时可用的中金所合约列表</span>
<span class="n">get_instrument_list</span><span class="p">(</span><span class="n">CodeTable</span><span class="o">.</span><span class="n">CFFEX</span><span class="p">,</span> <span class="s1">&#39;2018/1/1&#39;</span><span class="p">)</span>

<span class="c1"># 查询当前上证50合约列表及明细信息</span>
<span class="n">get_instrument_list</span><span class="p">(</span><span class="n">CodeTable</span><span class="o">.</span><span class="n">SZ50</span><span class="p">,</span> <span class="n">show_detail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-dividend">
<h4>get_dividend - 查询分红送配<a class="headerlink" href="#get-dividend" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_dividend">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_dividend</code><span class="sig-paren">(</span><em>symbol</em>, <em>start_date</em>, <em>end_date</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_dividend" title="Permalink to this definition">¶</a></dt>
<dd><p>查询分红送配</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbol</strong> (<em>str</em>) – 证券代码，带交易所代码，如”SH.600000”</li>
<li><strong>start_date</strong> (<em>str/date/datetime</em>) – 查询开始日期，字符串格式如”2017/1/3”</li>
<li><strong>end_date</strong> (<em>str/date/datetime</em>) – 查询结束日期，字符串格式如”2017/10/20”</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">返回除权除息数据列表</p>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">分红送配信息</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>证券代码（带交易所代码）</td>
</tr>
<tr class="row-odd"><td>date</td>
<td>除权除息日期 YYYYMMDD</td>
</tr>
<tr class="row-even"><td>bonus_ratio</td>
<td>送股比例</td>
</tr>
<tr class="row-odd"><td>dividend</td>
<td>红利</td>
</tr>
<tr class="row-even"><td>allot_ratio</td>
<td>配股比例</td>
</tr>
<tr class="row-odd"><td>allot_price</td>
<td>配股价</td>
</tr>
<tr class="row-even"><td>add_ratio</td>
<td>增发比例</td>
</tr>
<tr class="row-odd"><td>add_price</td>
<td>增发价</td>
</tr>
<tr class="row-even"><td>factor</td>
<td>折算系数，一般用于基金</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#查询浦发银行股票在2016/6/23到2017/5/25之间的分红送配信息</span>
<span class="n">get_dividend</span><span class="p">(</span><span class="s2">&quot;SH.600000&quot;</span><span class="p">,</span> <span class="s2">&quot;2016/6/23&quot;</span><span class="p">,</span> <span class="s2">&quot;2017/5/25&quot;</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="c1">#[{&#39;allot_ratio&#39;: 0.0, &#39;date&#39;: 20160623, &#39;symbol&#39;: &#39;SH.600000&#39;, &#39;dividend&#39;: 5.15,&#39;add_price&#39;: 0.0,</span>
<span class="s1">&#39;add_ratio&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;allot_price&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bonus_ratio&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;allot_ratio&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="mi">20170525</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;dividend&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;add_price&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="s1">&#39;add_ratio&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;allot_price&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bonus_ratio&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="is-suspended">
<h4>is_suspended - 是否停盘<a class="headerlink" href="#is-suspended" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.is_suspended">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">is_suspended</code><span class="sig-paren">(</span><em>symbol</em>, <em>date=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.is_suspended" title="Permalink to this definition">¶</a></dt>
<dd><p>是否停盘</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbol</strong> (<em>str</em>) – 证券编号，如：’SH.600000’</li>
<li><strong>date</strong> (<em>str/date/datetime</em>) – 查询日期，字符串格式如”2018/2/5”</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">停牌则返回True,否则返回False</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 浦发银行-20050928停牌</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">is_suspended</span><span class="p">(</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;2005/9/28&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="kc">True</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="is-st-stock-st">
<h4>is_st_stock - 是否是ST股票<a class="headerlink" href="#is-st-stock-st" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.is_st_stock">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">is_st_stock</code><span class="sig-paren">(</span><em>symbol</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.is_st_stock" title="Permalink to this definition">¶</a></dt>
<dd><p>是否是ST股票</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>symbol</strong> (<em>str</em>) – 证券编号，如：’SH.600000’</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">是ST(包括ST/*ST/S*ST/SST)则返回True,否则返回False</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># ST准油-002207 ST股</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">is_st_stock</span><span class="p">(</span><span class="s1">&#39;SZ.002207&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="kc">True</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-turnover-rate">
<h4>get_turnover_rate - 获取当日换手率<a class="headerlink" href="#get-turnover-rate" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_turnover_rate">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_turnover_rate</code><span class="sig-paren">(</span><em>symbol_or_list</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_turnover_rate" title="Permalink to this definition">¶</a></dt>
<dd><p>获取当日换手率, 不支持历史回测</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>symbol_or_list</strong> (<em>str|list</em>) – 证券编号或list(多个证券编号)，如：’SH.600000’ 或 [‘SH.600000’,’SH.600600’]</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">当传入一个合约时，直接返回换手率值（float)；传入多个合约的列表时，返回list(dict)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 1.查询浦发银行当日的换手率</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">get_turnover_rate</span><span class="p">(</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># 返回结果</span>
<span class="mf">0.139</span>

<span class="c1"># 2: 查询浦发银行和青岛啤酒当日的换手率</span>
<span class="n">symbol_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span><span class="s1">&#39;SH.600600&#39;</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">get_turnover_rate</span><span class="p">(</span><span class="n">symbol_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1">#返回结果</span>
<span class="p">[{</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">:</span> <span class="mf">0.139</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;SH.600600&#39;</span><span class="p">:</span> <span class="mf">0.8709</span><span class="p">}]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-financials">
<h4>get_financials - 查询财务报告数据<a class="headerlink" href="#get-financials" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_financials">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_financials</code><span class="sig-paren">(</span><em>table</em>, <em>symbol_or_list</em>, <em>stat_date</em>, <em>fields=None</em>, <em>filters=None</em>, <em>order_by=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_financials" title="Permalink to this definition">¶</a></dt>
<dd><p>查询指定合约的财务报告数据</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>table</strong> (<em>str</em>) – 财务报表名，目前支持income/cash_flow/balance</li>
<li><strong>symbol_or_list</strong> (<em>str|list</em>) – 证券编号或list(多个证券编号)，如：’SH.600000’ 或 [‘SH.600000’,’SH.600600’]</li>
<li><strong>stat_date</strong> – 报告期，分为年报和季度报，如”2017”表示年报，”2017q4”表示2017年第4季度报表</li>
<li><strong>fields</strong> (<em>list</em>) – 默认展示指定报表的所有字段，需要展示的字段</li>
<li><strong>filters</strong> (<em>str</em>) – 默认不过滤，查询报表的自定义过滤条件</li>
<li><strong>order_by</strong> (<em>str</em>) – 默认不排序，查询报表结果的排序，如按营业收入降序，’operating_revenue desc’</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">返回list(dict)，具体字段请参考 利润表 <a class="reference internal" href="index.html#income"><span class="std std-ref">income</span></a> 、现金流量表 <a class="reference internal" href="index.html#cash-flow"><span class="std std-ref">cash_flow</span></a> 、资产负债表 <a class="reference internal" href="index.html#balance"><span class="std std-ref">balance</span></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 1. 查询浦发银行、青岛啤酒中净利润&gt;10亿的17年第3季度利润表</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;income&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600600&#39;</span><span class="p">],</span> <span class="s1">&#39;2017q3&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span><span class="s1">&#39;stat_date&#39;</span><span class="p">,</span> <span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;net_profit&#39;</span><span class="p">],</span> <span class="s2">&quot;net_profit&gt;1000000000&quot;</span><span class="p">,</span> <span class="s2">&quot;net_profit desc&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1">#返回结果</span>
<span class="p">[{</span><span class="s1">&#39;stat_date&#39;</span><span class="p">:</span> <span class="s1">&#39;20170930&#39;</span><span class="p">,</span> <span class="s1">&#39;net_profit&#39;</span><span class="p">:</span> <span class="mf">13874000000.0</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span>  <span class="s1">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s1">&#39;20171028&#39;</span><span class="p">}]</span>

<span class="c1"># 2. 查询浦发银行17年度的资产负债表</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;balance&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;2017&#39;</span><span class="p">)</span>

<span class="c1"># 3. 查询浦发银行17年第1季度的现金流量表</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;cash_flow&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.600000&#39;</span><span class="p">,</span> <span class="s1">&#39;2017q1&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="get-money-flow">
<h4>get_money_flow - 查询资金流向<a class="headerlink" href="#get-money-flow" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.md_api.get_money_flow">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_money_flow</code><span class="sig-paren">(</span><em>symbol_or_list</em>, <em>start_date=None</em>, <em>end_date=None</em>, <em>fields=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_money_flow" title="Permalink to this definition">¶</a></dt>
<dd><p>获取一只或一组股票在一个时间段内的资金流向</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>symbol_or_list</strong> (<em>str|list</em>) – 证券编号或list(多个证券编号)，如：’SH.600000’ 或 [‘SH.600000’,’SH.600600’]</li>
<li><strong>start_date</strong> (<em>str/date/datetime</em>) – 开始日期，字符串格式如”2018/2/5”,默认为平台提供的数据的最早日期</li>
<li><strong>end_date</strong> (<em>str/date/datetime</em>) – 结束日期，字符串格式如”2018/2/10”,默认为当前交易日</li>
<li><strong>fields</strong> – 字段名或者 list, 可选. 默认为 None, 表示取全部字段。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">返回list(dict)</p>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">资金流向信息</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>证券代码</td>
</tr>
<tr class="row-odd"><td>date</td>
<td>日期 YYYYMMDD</td>
</tr>
<tr class="row-even"><td>net_amt_main</td>
<td>主力净额(万)</td>
</tr>
<tr class="row-odd"><td>net_pct_main</td>
<td>主力净占比(%)</td>
</tr>
<tr class="row-even"><td>net_amt_xl</td>
<td>超大单净额(万)</td>
</tr>
<tr class="row-odd"><td>net_pct_xl</td>
<td>超大单净占比(%)</td>
</tr>
<tr class="row-even"><td>net_amt_l</td>
<td>大单净额(万)</td>
</tr>
<tr class="row-odd"><td>net_pct_l</td>
<td>大单净占比(%)</td>
</tr>
<tr class="row-even"><td>net_amt_m</td>
<td>中单净额(万)</td>
</tr>
<tr class="row-odd"><td>net_pct_m</td>
<td>中单净占比(%)</td>
</tr>
<tr class="row-even"><td>net_amt_s</td>
<td>小单净额(万)</td>
</tr>
<tr class="row-odd"><td>net_pct_s</td>
<td>小单净占比(%)</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="get-fundamentals">
<h4>get_fundamentals - 获取财务数据<a class="headerlink" href="#get-fundamentals" title="Permalink to this headline">¶</a></h4>
<p>直接通过SQL查询。</p>
<dl class="function">
<dt id="sparkquant.api.md_api.get_fundamentals">
<code class="descclassname">sparkquant.api.md_api.</code><code class="descname">get_fundamentals</code><span class="sig-paren">(</span><em>sql</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.md_api.get_fundamentals" title="Permalink to this definition">¶</a></dt>
<dd><p>获取财务数据</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sql</strong> (<em>str</em>) – Sql查询语句</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">返回对应的财务数据</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="api-mdapi-callback">
<span id="id3"></span><h3>数据事件<a class="headerlink" href="#api-mdapi-callback" title="Permalink to this headline">¶</a></h3>
<div class="section" id="on-tick-tick">
<h4>on_tick - 返回Tick数据<a class="headerlink" href="#on-tick-tick" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">on_tick(context,</span> <span class="pre">tick_dict):</span></code></div></blockquote>
<p>订阅了Tick行情后（请参考 <a class="reference internal" href="#subscribe"><span class="std std-ref">subscribe - 订阅行情</span></a>），系统会推送上下文 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 和具体的Tick信息。</p>
<p>Tick行情更新时，该函数会被持续调用。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>订阅的类型或品种不同，返回的tick结构也略有不同，请参考</p>
<p>股票Tick <a class="reference internal" href="index.html#securitytickdata"><span class="std std-ref">SecurityTickData</span></a></p>
<p>期货Tick <a class="reference internal" href="index.html#futurestickdata"><span class="std std-ref">FuturesTickData</span></a></p>
<p>指数Tick <a class="reference internal" href="index.html#indextickdata"><span class="std std-ref">IndexTickData</span></a></p>
<p>逐笔委托 <a class="reference internal" href="index.html#tickbytickentrust"><span class="std std-ref">TickByTickEntrust</span></a></p>
<p class="last">逐笔成交 <a class="reference internal" href="index.html#tickbyticktrade"><span class="std std-ref">TickByTickTrade</span></a></p>
</div>
</div>
<div class="section" id="on-bar-bar">
<h4>on_bar - 返回Bar数据<a class="headerlink" href="#on-bar-bar" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">on_bar(context,</span> <span class="pre">bar_dict):</span></code></div></blockquote>
<p>订阅了Bar行情后（请参考 <a class="reference internal" href="#subscribe"><span class="std std-ref">subscribe - 订阅行情</span></a>），系统会推送上下文 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 和具体的Bar信息。</p>
<p>Bar行情更新时（目前为每分钟更新），该函数会被持续调用。</p>
<p>返回的Bar数据结构，请参考 <a class="reference internal" href="index.html#securitybardata"><span class="std std-ref">SecurityBarData</span></a></p>
</div>
</div>
<span id="document-api/tdapi"></span><div class="section" id="module-sparkquant.api.td_api">
<span id="id1"></span><span id="api-tdapi-order"></span><h3>交易函数<a class="headerlink" href="#module-sparkquant.api.td_api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="order-volume">
<h4>order_volume - 指定数量下单<a class="headerlink" href="#order-volume" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.td_api.order_volume">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">order_volume</code><span class="sig-paren">(</span><em>account_id</em>, <em>symbol</em>, <em>volume</em>, <em>price=0</em>, <em>order_type=None</em>, <em>position_effect=&lt;PositionEffect.Open: 0&gt;</em>, <em>hedge_flag=&lt;HedgeFlag.Non: 0&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.order_volume" title="Permalink to this definition">¶</a></dt>
<dd><p>按指定数量委托下单</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>account_id</strong> (<em>str</em>) – 资金账户id。</li>
<li><strong>symbol</strong> (<em>str</em>) – 单个标的代码，例如SH.600000。</li>
<li><strong>volume</strong> (<em>int</em>) – 委托量。正数代表买入，负数代表卖出。</li>
<li><strong>price</strong> (<em>float</em>) – 委托价。如果price=0为市价单，否则为限价单。</li>
<li><strong>order_type</strong> (<em>None/OrderType</em>) – 订单类型，支持市价单和限价单。 其中市价单有多种类型可供选择，详情请参考 <a class="reference internal" href="index.html#ordertype"><span class="std std-ref">OrderType</span></a> 。</li>
<li><strong>position_effect</strong> (<em>PositionEffect</em>) – 开平仓类型，期货默认为开仓可选类型，可选类型请参考 <a class="reference internal" href="index.html#positioneffect"><span class="std std-ref">PositionEffect</span></a>。
股票交易不需要该参数。</li>
<li><strong>hedge_flag</strong> (<em>HedgeFlag</em>) – 投机套保标识，可选类型请参考 <a class="reference internal" href="index.html#hedgeflag"><span class="std std-ref">HedgeFlag</span></a>。 股票交易不需要该参数。</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">int error_no,str order_id: 返回请求结果和报单编号，其中 error_no: 成功返回0，失败返回错误码。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># --- 股票交易（使用资金账号 6814） ---</span>
<span class="c1">#以限价 23.59 元买入Buy 1000 股的万科A股票</span>
<span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">23.59</span><span class="p">)</span>

<span class="c1">#以市价购买Buy 1000 股的万科A股票 （市价单功能暂未支持）</span>
<span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1">#使用资金账号 6814 以市价卖出Sell 1000股的万科A股票 （市价单功能暂未支持）</span>
<span class="n">error_no</span><span class="p">,</span> <span class="n">order_id</span> <span class="o">=</span> <span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error_no</span><span class="p">,</span> <span class="n">order_id</span><span class="p">)</span>
<span class="c1">#输出（0表示报单请求成功)</span>
<span class="c1">#0 01201809191052380000000205</span>

<span class="c1"># --- 期货交易（使用资金账号 6814） ---</span>
<span class="c1">#以限价 49220 元卖出Sell开仓Open 3 手的铜1908期货合约</span>
<span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SHFE.cu1908&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">49220</span><span class="p">)</span>

<span class="c1">#以限价 49220 元买入Buy平仓Close 3 手的铜1908期货合约</span>
<span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SHFE.cu1908&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">49220</span><span class="p">,</span> <span class="n">position_effect</span> <span class="o">=</span> <span class="n">PositionEffect</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>

<span class="c1">#以市价买入Buy开仓Open 3 手的铜1908期货合约（市价单功能暂未支持）</span>
<span class="n">order_volume</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="s1">&#39;SHFE.cu1908&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="order-batch">
<h4>order_batch - 批量下单<a class="headerlink" href="#order-batch" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.td_api.order_batch">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">order_batch</code><span class="sig-paren">(</span><em>account_id</em>, <em>order_list</em>, <em>is_async=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.order_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>批量下单</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>account_id</strong> (<em>str</em>) – 资金账户id</li>
<li><strong>order_list</strong> (<em>list</em>) – 委托列表</li>
<li><strong>is_async</strong> (<em>bool</em>) – 异步标识  True:异步 False:同步</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">int errno: 成功返回0，失败返回错误码;  list order_id_list: 同步模式返回订单id列表，异步模式返回空列表</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">order_1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span><span class="s1">&#39;SZ.000001&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="n">position_effect</span><span class="o">=</span><span class="n">PositionEffect</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span>
                <span class="s1">&#39;order_type&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hedge_flag&#39;</span><span class="p">:</span><span class="n">HedgeFlag</span><span class="o">.</span><span class="n">Non</span><span class="p">,</span> <span class="s1">&#39;cl_order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ext_info&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="n">order_2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;symbol&#39;</span><span class="p">:</span><span class="s1">&#39;SZ.000002&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">position_effect</span><span class="o">=</span><span class="n">PositionEffect</span><span class="o">.</span><span class="n">Open</span><span class="p">,</span>
                <span class="s1">&#39;order_type&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hedge_flag&#39;</span><span class="p">:</span><span class="n">HedgeFlag</span><span class="o">.</span><span class="n">Non</span><span class="p">,</span> <span class="s1">&#39;cl_order_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ext_info&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="n">order_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">order_1</span><span class="p">,</span> <span class="n">order_2</span><span class="p">]</span>
<span class="n">order_batch</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="n">order_list</span><span class="p">)</span>

<span class="c1"># volume: 正数为买，负数为卖</span>
<span class="c1"># price: 订单价格， 0 为市价单</span>
<span class="c1"># cl_order_id : 异步模式下订单的客户方id，同步模式可为空</span>
<span class="c1"># order_type: None/OrderType</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="cancel-order">
<h4>cancel_order - 撤单<a class="headerlink" href="#cancel-order" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="sparkquant.api.td_api.cancel_order">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">cancel_order</code><span class="sig-paren">(</span><em>account_id</em>, <em>order_list=[]</em>, <em>account_type=&lt;AccountType.Stock: 1&gt;</em>, <em>sequence_number=0</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.cancel_order" title="Permalink to this definition">¶</a></dt>
<dd><p>撤单</p>
<p>:param str account_id:资金账号id
:param list order_list:订单id列表
:param AccountType account_type:账号类型
:param sequence_number:交易序号，即批次号。给0撤全部，给非0值撤指定批次。此参数只有在order_list为空的情况下才有效
:return:int error_no: 成功返回0，失败返回错误码 list cancel_list:撤单详情列表</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># 通过指定撤单id列表撤单</span>
<span class="n">order_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01201809251101590000000102&#39;</span><span class="p">,</span> <span class="s1">&#39;01201809251101590000000103&#39;</span><span class="p">]</span>
<span class="n">order_cancel</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="n">order_list</span><span class="p">,</span> <span class="n">AccountType</span><span class="o">.</span><span class="n">Stock</span><span class="p">)</span>

<span class="c1"># 通过制定批次号撤单</span>
<span class="n">order_cancel</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">,</span> <span class="n">account_type</span><span class="o">=</span><span class="n">AccountType</span><span class="o">.</span><span class="n">Stock</span><span class="p">,</span> <span class="n">sequence_number</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># 撤销全部未完成股票订单</span>
<span class="n">order_cancel</span><span class="p">(</span><span class="s1">&#39;6814&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="report-params">
<h4>report_params - 上报参数<a class="headerlink" href="#report-params" title="Permalink to this headline">¶</a></h4>
<p>客户端收到该消息后会更新相应的策略参数。</p>
<dl class="function">
<dt id="sparkquant.api.td_api.report_params">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">report_params</code><span class="sig-paren">(</span><em>params_list</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.report_params" title="Permalink to this definition">¶</a></dt>
<dd><p>上报策略参数</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>params_list</strong> (<em>list</em>) – 参数的列表，列表元素为字典</td>
</tr>
<tr class="field-even field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">params_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mi">123</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;str2&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">100.12</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">strategy_report_params</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="report-indexes">
<h4>report_indexes - 上报自定义指标<a class="headerlink" href="#report-indexes" title="Permalink to this headline">¶</a></h4>
<p>客户端收到该消息后会更新相应的自定义指标。</p>
<dl class="function">
<dt id="sparkquant.api.td_api.report_indexes">
<code class="descclassname">sparkquant.api.td_api.</code><code class="descname">report_indexes</code><span class="sig-paren">(</span><em>indexes_list</em><span class="sig-paren">)</span><a class="headerlink" href="#sparkquant.api.td_api.report_indexes" title="Permalink to this definition">¶</a></dt>
<dd><p>上报自定义策略指标到客户端展示
:param list indexes_list: 参数的列表，列表元素为字典</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">indexes_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mi">123</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;str2&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;key3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;describe&quot;</span><span class="p">:</span><span class="s2">&quot;desc3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="mf">100.12</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">strategy_report_indexes</span><span class="p">(</span><span class="n">indexes_list</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<div class="section" id="api-tdapi-callback">
<span id="id2"></span><h3>交易事件<a class="headerlink" href="#api-tdapi-callback" title="Permalink to this headline">¶</a></h3>
<div class="section" id="on-order-status">
<h4>on_order_status - 返回报单状态<a class="headerlink" href="#on-order-status" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">on_order_status(context,</span> <span class="pre">order):</span></code></div></blockquote>
<p>当用户请求的报单状态发生变化时（报单状态请参考 <a class="reference internal" href="index.html#orderstatus"><span class="std std-ref">OrderStatus</span></a>），系统会推送上下文 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 和具体的Order信息。</p>
<p>Order信息请参考 <a class="reference internal" href="index.html#order"><span class="std std-ref">Order</span></a></p>
</div>
<div class="section" id="on-execution-report">
<h4>on_execution_report - 返回成交回报<a class="headerlink" href="#on-execution-report" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">on_execution_report(context,</span> <span class="pre">exec_report):</span></code></div></blockquote>
<p>当用户请求的报单状态发生成交时，会接收到系统会推送上下文 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 和具体的Trade信息。</p>
<p>Trade信息请参考 <a class="reference internal" href="index.html#trade"><span class="std std-ref">Trade</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>报单被撤时，会收到报单状态回报和成交回报，其中成交回报的exec_type字段表示了成交回报类型。</p>
<table border="1" class="last docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">成交回报类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>普通回报</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>撤单回报</td>
</tr>
<tr class="row-even"><td>3</td>
<td>普通废单回报</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>内部撤单回报，还未到交易所便被撤下来</td>
</tr>
<tr class="row-even"><td>5</td>
<td>撤单废单回报</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="on-set-params">
<h4>on_set_params - 返回策略参数修改回报<a class="headerlink" href="#on-set-params" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><code class="code docutils literal notranslate"><span class="pre">on_set_params(context,</span> <span class="pre">list_json_params):</span></code></div></blockquote>
<p>当策略参数修改时，会接收到系统会推送上下文 <a class="reference internal" href="index.html#module-sparkquant.strategy.strategy_context"><span class="std std-ref">context - 策略上下文</span></a> 和具体的策略参数信息（json格式）。</p>
<p>策略参数信息请参考 <a class="reference internal" href="#report-params"><span class="std std-ref">report_params - 上报参数</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">只有在实盘交易环境中才能接收到策略参数修改回报。</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-api/enums"></span><div class="section" id="api-enums">
<span id="id1"></span><h2>枚举常量<a class="headerlink" href="#api-enums" title="Permalink to this headline">¶</a></h2>
<div class="section" id="accounttype">
<h3>AccountType<a class="headerlink" href="#accounttype" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">账户类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>All</td>
<td>所有账户</td>
</tr>
<tr class="row-odd"><td>Stock</td>
<td>股票账户</td>
</tr>
<tr class="row-even"><td>Futures</td>
<td>期货账户</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adjust">
<h3>Adjust<a class="headerlink" href="#adjust" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">复权方式</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Non</td>
<td>不复权</td>
</tr>
<tr class="row-odd"><td>Pre</td>
<td>前复权</td>
</tr>
<tr class="row-even"><td>Post</td>
<td>后复权</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cancelflag">
<h3>CancelFlag<a class="headerlink" href="#cancelflag" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">撤单标识</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>不是撤单</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>是撤单</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="credittype">
<h3>CreditType<a class="headerlink" href="#credittype" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">交易类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>普通交易</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>融资交易</td>
</tr>
<tr class="row-even"><td>3</td>
<td>融券交易</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="codetable">
<h3>CodeTable<a class="headerlink" href="#codetable" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>股票</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">证券代码表</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SHAG</td>
<td>上交所A股</td>
</tr>
<tr class="row-odd"><td>SZAG</td>
<td>沪深300</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>指数成分股和指数</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">证券代码表</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>HS300</td>
<td>沪深300</td>
</tr>
<tr class="row-odd"><td>AGZS</td>
<td>上证A股</td>
</tr>
<tr class="row-even"><td>SZAZ</td>
<td>深证A股</td>
</tr>
<tr class="row-odd"><td>SZ50</td>
<td>上证50</td>
</tr>
<tr class="row-even"><td>ZZ500</td>
<td>中证500</td>
</tr>
<tr class="row-odd"><td>ZXBZ</td>
<td>中小板</td>
</tr>
<tr class="row-even"><td>CYBZ</td>
<td>创业板指</td>
</tr>
<tr class="row-odd"><td>QSAG</td>
<td>全市场A股</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>期货和期权</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">证券代码表</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CFFEX</td>
<td>中金所期货</td>
</tr>
<tr class="row-odd"><td>SHFE</td>
<td>上期所期货</td>
</tr>
<tr class="row-even"><td>DCE</td>
<td>大商所期货</td>
</tr>
<tr class="row-odd"><td>CZCE</td>
<td>郑商所期货</td>
</tr>
<tr class="row-even"><td>SHOP</td>
<td>上交所期权</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hedgeflag">
<h3>HedgeFlag<a class="headerlink" href="#hedgeflag" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">投机套保标识</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Non</td>
<td>未指定</td>
</tr>
<tr class="row-odd"><td>Speculation</td>
<td>投机</td>
</tr>
<tr class="row-even"><td>Hedge</td>
<td>套保</td>
</tr>
<tr class="row-odd"><td>Arbitrage</td>
<td>套利</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="orderstatus">
<h3>OrderStatus<a class="headerlink" href="#orderstatus" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">报单状态</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>订单待报</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>订单已报</td>
</tr>
<tr class="row-even"><td>3</td>
<td>订单部分成交</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>订单全部成交</td>
</tr>
<tr class="row-even"><td>5</td>
<td>撤单待报</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>已报待撤</td>
</tr>
<tr class="row-even"><td>7</td>
<td>订单已撤销</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>部成部撤</td>
</tr>
<tr class="row-even"><td>9</td>
<td>订单已拒绝</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="positioneffect">
<h3>PositionEffect<a class="headerlink" href="#positioneffect" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">开平仓类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Open</td>
<td>开仓</td>
</tr>
<tr class="row-odd"><td>Close</td>
<td>平仓</td>
</tr>
<tr class="row-even"><td>CloseToday</td>
<td>平今仓</td>
</tr>
<tr class="row-odd"><td>CloseYesterday</td>
<td>平昨仓</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="positionside">
<h3>PositionSide<a class="headerlink" href="#positionside" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">市场代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Long</td>
<td>多仓</td>
</tr>
<tr class="row-odd"><td>Short</td>
<td>空仓</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="marketcode">
<h3>MarketCode<a class="headerlink" href="#marketcode" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">市场代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SH</td>
<td>上海证券交易所</td>
</tr>
<tr class="row-odd"><td>SZ</td>
<td>深圳证券交易所</td>
</tr>
<tr class="row-even"><td>CFFEX</td>
<td>中金所</td>
</tr>
<tr class="row-odd"><td>SHFE</td>
<td>上期所</td>
</tr>
<tr class="row-even"><td>CZCE</td>
<td>郑商所</td>
</tr>
<tr class="row-odd"><td>DEC</td>
<td>大商所</td>
</tr>
<tr class="row-even"><td>HK</td>
<td>香港证券交易所</td>
</tr>
<tr class="row-odd"><td>SHOP</td>
<td>上交所期权市场</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ordertype">
<h3>OrderType<a class="headerlink" href="#ordertype" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">报单类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LimitOrder</td>
<td>限价委托</td>
</tr>
<tr class="row-odd"><td>MarketOrder_BOC</td>
<td>对手方最优价格，深圳证券交易所</td>
</tr>
<tr class="row-even"><td>MarketOrder_BOP</td>
<td>本方最优价格，深圳证券交易所</td>
</tr>
<tr class="row-odd"><td>MarketOrder_B5TC</td>
<td>最优五档剩余转撤销，上海/深圳证券交易所</td>
</tr>
<tr class="row-even"><td>MarketOrder_B5TL</td>
<td>最优五档剩余转限价，上海证券交易所</td>
</tr>
<tr class="row-odd"><td>MarketOrder_IOC</td>
<td>即时成交剩余转撤销，深圳证券交易所</td>
</tr>
<tr class="row-even"><td>MarketOrder_AON</td>
<td>全额成交或撤销，深圳证券交易所</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="orderside">
<h3>OrderSide<a class="headerlink" href="#orderside" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">买卖方向</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>买</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>卖</td>
</tr>
<tr class="row-even"><td>3</td>
<td>多头开仓</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>多头平仓</td>
</tr>
<tr class="row-even"><td>5</td>
<td>空头开仓</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>空头平仓</td>
</tr>
<tr class="row-even"><td>8</td>
<td>今仓多头平仓</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>今仓空头平仓</td>
</tr>
<tr class="row-even"><td>11</td>
<td>昨仓多头平仓</td>
</tr>
<tr class="row-odd"><td>12</td>
<td>昨仓空头平仓</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tradereporttype">
<h3>TradeReportType<a class="headerlink" href="#tradereporttype" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">成交回报类型</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>普通回报</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>撤单回报</td>
</tr>
<tr class="row-even"><td>3</td>
<td>普通废单回报</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>内部撤单回报，还未到交易所便被撤下来</td>
</tr>
<tr class="row-even"><td>5</td>
<td>撤单废单回报</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-api/financials"></span><div class="section" id="api-financials">
<span id="id1"></span><h2>财务数据信息<a class="headerlink" href="#api-financials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="income">
<h3>income<a class="headerlink" href="#income" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利润表</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>公司名称</td>
</tr>
<tr class="row-odd"><td>stat_date</td>
<td>报告期</td>
</tr>
<tr class="row-even"><td>pub_date</td>
<td>公告日期</td>
</tr>
<tr class="row-odd"><td>operating_revenue</td>
<td>营业收入(元)</td>
</tr>
<tr class="row-even"><td>interest_income</td>
<td>利息收入(元)</td>
</tr>
<tr class="row-odd"><td>premiums_earned</td>
<td>已赚保费(元)</td>
</tr>
<tr class="row-even"><td>commission_income</td>
<td>手续费及佣金收入(元)</td>
</tr>
<tr class="row-odd"><td>total_operating_cost</td>
<td>营业总成本(元)</td>
</tr>
<tr class="row-even"><td>operating_cost</td>
<td>营业成本(元)</td>
</tr>
<tr class="row-odd"><td>interest_expense</td>
<td>利息支出(元)</td>
</tr>
<tr class="row-even"><td>commission_expense</td>
<td>手续费及佣金支出(元)</td>
</tr>
<tr class="row-odd"><td>refunded_premiums</td>
<td>退保金(元)</td>
</tr>
<tr class="row-even"><td>pay_insurance_claims</td>
<td>赔付总支出(元)</td>
</tr>
<tr class="row-odd"><td>withdraw_insurance_contract_reserve</td>
<td>提取保险责任准备金(元)</td>
</tr>
<tr class="row-even"><td>policy_dividend_payout</td>
<td>保单红利支出(元)</td>
</tr>
<tr class="row-odd"><td>reinsurance_cost</td>
<td>分保费用(元)</td>
</tr>
<tr class="row-even"><td>operating_tax_surcharges</td>
<td>营业税金及附加(元)</td>
</tr>
<tr class="row-odd"><td>sale_expense</td>
<td>销售费用(元)</td>
</tr>
<tr class="row-even"><td>administration_expense</td>
<td>管理费用(元)</td>
</tr>
<tr class="row-odd"><td>financial_expense</td>
<td>财务费用(元)</td>
</tr>
<tr class="row-even"><td>asset_impairment_loss</td>
<td>资产减值损失(元)</td>
</tr>
<tr class="row-odd"><td>fair_value_variable_income</td>
<td>公允价值变动收益(元)</td>
</tr>
<tr class="row-even"><td>net_investment_income</td>
<td>投资净收益(元)</td>
</tr>
<tr class="row-odd"><td>invest_income_associates</td>
<td>对联营企业和合营企业的投资收益(元)</td>
</tr>
<tr class="row-even"><td>net_exchange_income</td>
<td>汇兑净收益(元)</td>
</tr>
<tr class="row-odd"><td>operating_profit</td>
<td>营业利润(元)</td>
</tr>
<tr class="row-even"><td>non_operating_revenue</td>
<td>营业外收入(元)</td>
</tr>
<tr class="row-odd"><td>non_operating_expense</td>
<td>营业外支出(元)</td>
</tr>
<tr class="row-even"><td>disposal_loss_non_current_liability</td>
<td>非流动资产处置净损失(元)</td>
</tr>
<tr class="row-odd"><td>total_profit</td>
<td>利润总额(元)</td>
</tr>
<tr class="row-even"><td>income_tax_expense</td>
<td>所得税(元)</td>
</tr>
<tr class="row-odd"><td>net_profit</td>
<td>净利润(元)</td>
</tr>
<tr class="row-even"><td>np_parent_company_owners</td>
<td>归属于母公司股东的净利润(元)</td>
</tr>
<tr class="row-odd"><td>minority_profit</td>
<td>少数股东损益(元)</td>
</tr>
<tr class="row-even"><td>basic_eps</td>
<td>基本每股收益(元)</td>
</tr>
<tr class="row-odd"><td>diluted_eps</td>
<td>稀释每股收益(元)</td>
</tr>
<tr class="row-even"><td>other_composite_income</td>
<td>其他综合收益(元)</td>
</tr>
<tr class="row-odd"><td>total_composite_income</td>
<td>综合收益总额(元)</td>
</tr>
<tr class="row-even"><td>ci_parent_company_owners</td>
<td>综合收益总额(母公司)</td>
</tr>
<tr class="row-odd"><td>ci_minority_owners</td>
<td>综合收益总额(少数股东)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cash-flow">
<h3>cash_flow<a class="headerlink" href="#cash-flow" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">现金流量表</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>股票代码</td>
</tr>
<tr class="row-odd"><td>pub_date</td>
<td>公告日期</td>
</tr>
<tr class="row-even"><td>stat_date</td>
<td>报告期</td>
</tr>
<tr class="row-odd"><td>goods_sale_and_service_render_cash</td>
<td>销售商品、提供劳务收到的现金(元)</td>
</tr>
<tr class="row-even"><td>net_deposit_increase</td>
<td>客户存款和同业存放款项净增加额(元)</td>
</tr>
<tr class="row-odd"><td>net_borrowing_from_central_bank</td>
<td>向中央银行借款净增加额(元)</td>
</tr>
<tr class="row-even"><td>net_borrowing_from_finance_co</td>
<td>向其他金融机构拆入资金净增加额(元)</td>
</tr>
<tr class="row-odd"><td>net_original_insurance_cash</td>
<td>收到原保险合同保费取得的现金(元)</td>
</tr>
<tr class="row-even"><td>net_cash_received_from_reinsurance_business</td>
<td>收到再保险业务现金净额(元)</td>
</tr>
<tr class="row-odd"><td>net_insurer_deposit</td>
<td>保户储金净增加额(元)</td>
</tr>
<tr class="row-even"><td>net_deal_trading_assets</td>
<td>处置交易性金融资产净增加额(元)</td>
</tr>
<tr class="row-odd"><td>interest_and_commission_cashin</td>
<td>收取利息和手续费净增加额(元)</td>
</tr>
<tr class="row-even"><td>net_increase_in_placements</td>
<td>拆入资金净增加额(元)</td>
</tr>
<tr class="row-odd"><td>net_buyback</td>
<td>回购业务资金净增加额(元)</td>
</tr>
<tr class="row-even"><td>tax_levy_refund</td>
<td>收到的税费返还(元)</td>
</tr>
<tr class="row-odd"><td>other_cashin_related_operate</td>
<td>收到其他与经营活动有关的现金(元)</td>
</tr>
<tr class="row-even"><td>subtotal_operate_cash_inflow</td>
<td>经营活动现金流入小计(元)</td>
</tr>
<tr class="row-odd"><td>goods_and_services_cash_paid</td>
<td>购买商品、接受劳务支付的现金(元)</td>
</tr>
<tr class="row-even"><td>net_loan_and_advance_increase</td>
<td>客户贷款及垫款净增加额(元)</td>
</tr>
<tr class="row-odd"><td>net_deposit_in_cb_and_ib</td>
<td>存放中央银行和同业款项净增加额(元)</td>
</tr>
<tr class="row-even"><td>original_compensation_paid</td>
<td>支付原保险合同赔付款项的现金(元)</td>
</tr>
<tr class="row-odd"><td>handling_charges</td>
<td>支付手续费的现金(元)</td>
</tr>
<tr class="row-even"><td>policy_dividend_cash_paid</td>
<td>支付保单红利的现金(元)</td>
</tr>
<tr class="row-odd"><td>staff_behalf_paid</td>
<td>支付给职工以及为职工支付的现金(元)</td>
</tr>
<tr class="row-even"><td>tax_payments</td>
<td>支付的各项税费(元)</td>
</tr>
<tr class="row-odd"><td>other_operate_cash_paid</td>
<td>支付其他与经营活动有关的现金(元)</td>
</tr>
<tr class="row-even"><td>subtotal_operate_cash_outflow</td>
<td>经营活动现金流出小计(元)</td>
</tr>
<tr class="row-odd"><td>net_operate_cash_flow</td>
<td>经营活动产生的现金流量净额(元)</td>
</tr>
<tr class="row-even"><td>invest_withdrawal_cash</td>
<td>收回投资收到的现金(元)</td>
</tr>
<tr class="row-odd"><td>invest_proceeds</td>
<td>取得投资收益收到的现金(元)</td>
</tr>
<tr class="row-even"><td>fix_intan_other_asset_dispo_cash</td>
<td>处置固定资产、无形资产和其他长期资产收回的现金净额(元)</td>
</tr>
<tr class="row-odd"><td>net_cash_deal_subcompany</td>
<td>处置子公司及其他营业单位收到的现金净额(元)</td>
</tr>
<tr class="row-even"><td>other_cash_from_invest_act</td>
<td>收到其他与投资活动有关的现金(元)</td>
</tr>
<tr class="row-odd"><td>subtotal_invest_cash_inflow</td>
<td>投资活动现金流入小计(元)</td>
</tr>
<tr class="row-even"><td>fix_intan_other_asset_acqui_cash</td>
<td>购建固定资产、无形资产和其他长期资产支付的现金(元)</td>
</tr>
<tr class="row-odd"><td>invest_cash_paid</td>
<td>投资支付的现金(元)</td>
</tr>
<tr class="row-even"><td>impawned_loan_net_increase</td>
<td>质押贷款净增加额(元)</td>
</tr>
<tr class="row-odd"><td>net_cash_from_sub_company</td>
<td>取得子公司及其他营业单位支付的现金净额(元)</td>
</tr>
<tr class="row-even"><td>other_cash_to_invest_act</td>
<td>支付其他与投资活动有关的现金(元)</td>
</tr>
<tr class="row-odd"><td>subtotal_invest_cash_outflow</td>
<td>投资活动现金流出小计(元)</td>
</tr>
<tr class="row-even"><td>net_invest_cash_flow</td>
<td>投资活动产生的现金流量净额(元)</td>
</tr>
<tr class="row-odd"><td>cash_from_invest</td>
<td>吸收投资收到的现金(元)</td>
</tr>
<tr class="row-even"><td>cash_from_mino_s_invest_sub</td>
<td>子公司吸收少数股东投资收到的现金(元)</td>
</tr>
<tr class="row-odd"><td>cash_from_borrowing</td>
<td>取得借款收到的现金(元)</td>
</tr>
<tr class="row-even"><td>cash_from_bonds_issue</td>
<td>发行债券收到的现金(元)</td>
</tr>
<tr class="row-odd"><td>other_finance_act_cash</td>
<td>收到其他与筹资活动有关的现金(元)</td>
</tr>
<tr class="row-even"><td>subtotal_finance_cash_inflow</td>
<td>筹资活动现金流入小计(元)</td>
</tr>
<tr class="row-odd"><td>borrowing_repayment</td>
<td>偿还债务支付的现金(元)</td>
</tr>
<tr class="row-even"><td>dividend_interest_payment</td>
<td>分配股利、利润或偿付利息支付的现金(元)</td>
</tr>
<tr class="row-odd"><td>proceeds_from_sub_to_mino_s</td>
<td>子公司支付给少数股东的股利、利润(元)</td>
</tr>
<tr class="row-even"><td>other_finance_act_payment</td>
<td>支付其他与筹资活动有关的现金(元)</td>
</tr>
<tr class="row-odd"><td>subtotal_finance_cash_outflow</td>
<td>筹资活动现金流出小计(元)</td>
</tr>
<tr class="row-even"><td>net_finance_cash_flow</td>
<td>筹资活动产生的现金流量净额(元)</td>
</tr>
<tr class="row-odd"><td>exchange_rate_change_effect</td>
<td>汇率变动对现金及现金等价物的影响</td>
</tr>
<tr class="row-even"><td>cash_equivalent_increase</td>
<td>现金及现金等价物净增加额</td>
</tr>
<tr class="row-odd"><td>cash_equivalents_at_beginning</td>
<td>期初现金及现金等价物余额(元)</td>
</tr>
<tr class="row-even"><td>cash_and_equivalents_at_end</td>
<td>期末现金及现金等价物余额(元)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="balance">
<h3>balance<a class="headerlink" href="#balance" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">资产负债表</th>
<th class="head">字段说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>symbol</td>
<td>股票代码</td>
</tr>
<tr class="row-odd"><td>pub_date</td>
<td>公告日期</td>
</tr>
<tr class="row-even"><td>stat_date</td>
<td>报告期</td>
</tr>
<tr class="row-odd"><td>cash_equivalents</td>
<td>货币资金(元)</td>
</tr>
<tr class="row-even"><td>settlement_provi</td>
<td>结算备付金(元)</td>
</tr>
<tr class="row-odd"><td>lend_capital</td>
<td>拆出资金(元)</td>
</tr>
<tr class="row-even"><td>trading_assets</td>
<td>交易性金融资产(元)</td>
</tr>
<tr class="row-odd"><td>bill_receivable</td>
<td>应收票据(元)</td>
</tr>
<tr class="row-even"><td>account_receivable</td>
<td>应收账款(元)</td>
</tr>
<tr class="row-odd"><td>advance_payment</td>
<td>预付款项(元)</td>
</tr>
<tr class="row-even"><td>insurance_receivables</td>
<td>应收保费(元)</td>
</tr>
<tr class="row-odd"><td>reinsurance_receivables</td>
<td>应收分保账款(元)</td>
</tr>
<tr class="row-even"><td>reinsurance_contract_reserves_receivable</td>
<td>应收分保合同准备金(元)</td>
</tr>
<tr class="row-odd"><td>interest_receivable</td>
<td>应收利息(元)</td>
</tr>
<tr class="row-even"><td>dividend_receivable</td>
<td>应收股利(元)</td>
</tr>
<tr class="row-odd"><td>other_receivable</td>
<td>其他应收款(元)</td>
</tr>
<tr class="row-even"><td>bought_sellback_assets</td>
<td>买入返售金融资产(元)</td>
</tr>
<tr class="row-odd"><td>inventories</td>
<td>存货(元)</td>
</tr>
<tr class="row-even"><td>non_current_asset_in_one_year</td>
<td>一年内到期的非流动资产(元)</td>
</tr>
<tr class="row-odd"><td>other_current_assets</td>
<td>其他流动资产(元)</td>
</tr>
<tr class="row-even"><td>total_current_assets</td>
<td>流动资产合计(元)</td>
</tr>
<tr class="row-odd"><td>loan_and_advance</td>
<td>发放委托贷款及垫款(元)</td>
</tr>
<tr class="row-even"><td>hold_for_sale_assets</td>
<td>可供出售金融资产(元)</td>
</tr>
<tr class="row-odd"><td>hold_to_maturity_investments</td>
<td>持有至到期投资(元)</td>
</tr>
<tr class="row-even"><td>longterm_receivable_account</td>
<td>长期应收款(元)</td>
</tr>
<tr class="row-odd"><td>longterm_equity_invest</td>
<td>长期股权投资(元)</td>
</tr>
<tr class="row-even"><td>investment_property</td>
<td>投资性房地产(元)</td>
</tr>
<tr class="row-odd"><td>fixed_assets</td>
<td>固定资产(元)</td>
</tr>
<tr class="row-even"><td>constru_in_process</td>
<td>在建工程(元)</td>
</tr>
<tr class="row-odd"><td>construction_materials</td>
<td>工程物资(元)</td>
</tr>
<tr class="row-even"><td>fixed_assets_liquidation</td>
<td>固定资产清理(元)</td>
</tr>
<tr class="row-odd"><td>biological_assets</td>
<td>生产性生物资产(元)</td>
</tr>
<tr class="row-even"><td>oil_gas_assets</td>
<td>油气资产(元)</td>
</tr>
<tr class="row-odd"><td>intangible_assets</td>
<td>无形资产(元)</td>
</tr>
<tr class="row-even"><td>development_expenditure</td>
<td>开发支出(元)</td>
</tr>
<tr class="row-odd"><td>good_will</td>
<td>商誉(元)</td>
</tr>
<tr class="row-even"><td>long_deferred_expense</td>
<td>长期待摊费用(元)</td>
</tr>
<tr class="row-odd"><td>deferred_tax_assets</td>
<td>递延所得税资产(元)</td>
</tr>
<tr class="row-even"><td>other_non_current_assets</td>
<td>其他非流动资产(元)</td>
</tr>
<tr class="row-odd"><td>total_non_current_assets</td>
<td>非流动资产合计(元)</td>
</tr>
<tr class="row-even"><td>total_assets</td>
<td>资产总计(元)</td>
</tr>
<tr class="row-odd"><td>shortterm_loan</td>
<td>短期借款(元)</td>
</tr>
<tr class="row-even"><td>borrowing_from_centralbank</td>
<td>向中央银行借款(元)</td>
</tr>
<tr class="row-odd"><td>deposit_in_interbank</td>
<td>吸收存款及同业存放(元)</td>
</tr>
<tr class="row-even"><td>borrowing_capital</td>
<td>拆入资金(元)</td>
</tr>
<tr class="row-odd"><td>trading_liability</td>
<td>交易性金融负债(元)</td>
</tr>
<tr class="row-even"><td>notes_payable</td>
<td>应付票据(元)</td>
</tr>
<tr class="row-odd"><td>accounts_payable</td>
<td>应付账款(元)</td>
</tr>
<tr class="row-even"><td>advance_peceipts</td>
<td>预收款项(元)</td>
</tr>
<tr class="row-odd"><td>sold_buyback_secu_proceeds</td>
<td>卖出回购金融资产款(元)</td>
</tr>
<tr class="row-even"><td>commission_payable</td>
<td>应付手续费及佣金(元)</td>
</tr>
<tr class="row-odd"><td>salaries_payable</td>
<td>应付职工薪酬(元)</td>
</tr>
<tr class="row-even"><td>taxs_payable</td>
<td>应交税费(元)</td>
</tr>
<tr class="row-odd"><td>interest_payable</td>
<td>应付利息(元)</td>
</tr>
<tr class="row-even"><td>dividend_payable</td>
<td>应付股利(元)</td>
</tr>
<tr class="row-odd"><td>other_payable</td>
<td>其他应付款(元)</td>
</tr>
<tr class="row-even"><td>reinsurance_payables</td>
<td>应付分保账款(元)</td>
</tr>
<tr class="row-odd"><td>insurance_contract_reserves</td>
<td>保险合同准备金(元)</td>
</tr>
<tr class="row-even"><td>proxy_secu_proceeds</td>
<td>代理买卖证券款(元)</td>
</tr>
<tr class="row-odd"><td>receivings_from_vicariously_sold_securities</td>
<td>代理承销证券款(元)</td>
</tr>
<tr class="row-even"><td>non_current_liability_in_one_year</td>
<td>一年内到期的非流动负债(元)</td>
</tr>
<tr class="row-odd"><td>other_current_liability</td>
<td>其他流动负债(元)</td>
</tr>
<tr class="row-even"><td>total_current_liability</td>
<td>流动负债合计(元)</td>
</tr>
<tr class="row-odd"><td>longterm_loan</td>
<td>长期借款(元)</td>
</tr>
<tr class="row-even"><td>bonds_payable</td>
<td>应付债券(元)</td>
</tr>
<tr class="row-odd"><td>longterm_account_payable</td>
<td>长期应付款(元)</td>
</tr>
<tr class="row-even"><td>specific_account_payable</td>
<td>专项应付款(元)</td>
</tr>
<tr class="row-odd"><td>estimate_liability</td>
<td>预计负债(元)</td>
</tr>
<tr class="row-even"><td>deferred_tax_liability</td>
<td>递延所得税负债(元)</td>
</tr>
<tr class="row-odd"><td>other_non_current_liability</td>
<td>其他非流动负债(元)</td>
</tr>
<tr class="row-even"><td>total_non_current_liability</td>
<td>非流动负债合计(元)</td>
</tr>
<tr class="row-odd"><td>total_liability</td>
<td>负债合计(元)</td>
</tr>
<tr class="row-even"><td>capital_reserve_fund</td>
<td>资本公积金(元)</td>
</tr>
<tr class="row-odd"><td>treasury_stock</td>
<td>库存股(元)</td>
</tr>
<tr class="row-even"><td>specific_reserves</td>
<td>专项储备(元)</td>
</tr>
<tr class="row-odd"><td>surplus_reserve_fund</td>
<td>盈余公积金(元)</td>
</tr>
<tr class="row-even"><td>ordinary_risk_reserve_fund</td>
<td>一般风险准备(元)</td>
</tr>
<tr class="row-odd"><td>retained_profit</td>
<td>未分配利润(元)</td>
</tr>
<tr class="row-even"><td>foreign_currency_report_conv_diff</td>
<td>外币报表折算差额(元)</td>
</tr>
<tr class="row-odd"><td>equities_parent_company_owners</td>
<td>归属于母公司股东权益合计(元)</td>
</tr>
<tr class="row-even"><td>minority_interests</td>
<td>少数股东权益(元)</td>
</tr>
<tr class="row-odd"><td>total_owner_equities</td>
<td>股东权益合计(元)</td>
</tr>
<tr class="row-even"><td>total_sheet_owner_equities</td>
<td>负债和股东权益合计</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-api/errornos"></span><div class="section" id="api-errors">
<span id="id1"></span><h2>错误码<a class="headerlink" href="#api-errors" title="Permalink to this headline">¶</a></h2>
<div class="section" id="api-errors-ok">
<span id="id2"></span><h3>成功（0）<a class="headerlink" href="#api-errors-ok" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>成功</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="oms-2000-2999">
<span id="api-errors-oms"></span><h3>OMS（2000~2999）<a class="headerlink" href="#oms-2000-2999" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2000</td>
<td>OMS错误码</td>
</tr>
<tr class="row-odd"><td>2101</td>
<td>内存数据库操作失败</td>
</tr>
<tr class="row-even"><td>2102</td>
<td>内存数据库未初始化</td>
</tr>
<tr class="row-odd"><td>2103</td>
<td>内存数据库关闭失败</td>
</tr>
<tr class="row-even"><td>2104</td>
<td>内存数据库找不到数据</td>
</tr>
<tr class="row-odd"><td>2105</td>
<td>数据库表项已存在</td>
</tr>
<tr class="row-even"><td>2106</td>
<td>数据库插入失败</td>
</tr>
<tr class="row-odd"><td>2107</td>
<td>数据库更新失败</td>
</tr>
<tr class="row-even"><td>2201</td>
<td>OMS业务失败</td>
</tr>
<tr class="row-odd"><td>2202</td>
<td>消息序列化失败</td>
</tr>
<tr class="row-even"><td>2203</td>
<td>pb消息无法反序列化</td>
</tr>
<tr class="row-odd"><td>2204</td>
<td>HTPP消息类型错误</td>
</tr>
<tr class="row-even"><td>2205</td>
<td>没有固定入参</td>
</tr>
<tr class="row-odd"><td>2206</td>
<td>没有固定出参</td>
</tr>
<tr class="row-even"><td>2207</td>
<td>没有会话ID</td>
</tr>
<tr class="row-odd"><td>2208</td>
<td>没有系统账户ID</td>
</tr>
<tr class="row-even"><td>2209</td>
<td>没有运行ID</td>
</tr>
<tr class="row-odd"><td>2210</td>
<td>没有账户ID</td>
</tr>
<tr class="row-even"><td>2211</td>
<td>错误的FID</td>
</tr>
<tr class="row-odd"><td>2212</td>
<td>初始化时没有资金列表</td>
</tr>
<tr class="row-even"><td>2213</td>
<td>数据库操作失败</td>
</tr>
<tr class="row-odd"><td>2214</td>
<td>资金出入方向错误</td>
</tr>
<tr class="row-even"><td>2215</td>
<td>资金不足以划出</td>
</tr>
<tr class="row-odd"><td>2216</td>
<td>下单钱不够</td>
</tr>
<tr class="row-even"><td>2217</td>
<td>下单券不够</td>
</tr>
<tr class="row-odd"><td>2218</td>
<td>撤单的订单状态不对，不能撤单</td>
</tr>
<tr class="row-even"><td>2219</td>
<td>柜台返回委托应答失败</td>
</tr>
<tr class="row-odd"><td>2220</td>
<td>柜台返回撤单应答失败</td>
</tr>
<tr class="row-even"><td>2221</td>
<td>先收到了成交应答，没有收到委托应答，找不到量化后台委托号</td>
</tr>
<tr class="row-odd"><td>2222</td>
<td>除数为0</td>
</tr>
<tr class="row-even"><td>2223</td>
<td>没有订阅推送消息</td>
</tr>
<tr class="row-odd"><td>2224</td>
<td>错误的页码</td>
</tr>
<tr class="row-even"><td>2225</td>
<td>错误的页大小，为0或是大于最大查询数</td>
</tr>
<tr class="row-odd"><td>2226</td>
<td>查询起止日期错误</td>
</tr>
<tr class="row-even"><td>2227</td>
<td>MAC地址错误</td>
</tr>
<tr class="row-odd"><td>2228</td>
<td>没有委托信息</td>
</tr>
<tr class="row-even"><td>2229</td>
<td>标的市场错误</td>
</tr>
<tr class="row-odd"><td>2230</td>
<td>标的代码为空</td>
</tr>
<tr class="row-even"><td>2231</td>
<td>委托价格非法</td>
</tr>
<tr class="row-odd"><td>2232</td>
<td>委托量非法</td>
</tr>
<tr class="row-even"><td>2233</td>
<td>委托方向非法(非买/卖)</td>
</tr>
<tr class="row-odd"><td>2234</td>
<td>没有委托单号</td>
</tr>
<tr class="row-even"><td>2235</td>
<td>委托单号为空</td>
</tr>
<tr class="row-odd"><td>2236</td>
<td>柜台的委托应答中没有柜台ID</td>
</tr>
<tr class="row-even"><td>2237</td>
<td>成交类型非法</td>
</tr>
<tr class="row-odd"><td>2238</td>
<td>仓位方向非法(非多非空)</td>
</tr>
<tr class="row-even"><td>2239</td>
<td>没有该笔委托记录</td>
</tr>
<tr class="row-odd"><td>2240</td>
<td>委托表存在问题，出现了两笔以上的委托</td>
</tr>
<tr class="row-even"><td>2241</td>
<td>期货平仓仓位不够</td>
</tr>
<tr class="row-odd"><td>2242</td>
<td>期货平今仓仓位不够</td>
</tr>
<tr class="row-even"><td>2243</td>
<td>期货平昨仓仓位不够</td>
</tr>
<tr class="row-odd"><td>2244</td>
<td>保证金率未设置</td>
</tr>
<tr class="row-even"><td>2245</td>
<td>多头保证金率未设置</td>
</tr>
<tr class="row-odd"><td>2246</td>
<td>空头保证金率未设置</td>
</tr>
<tr class="row-even"><td>2247</td>
<td>金额过大</td>
</tr>
<tr class="row-odd"><td>2248</td>
<td>金额为负数</td>
</tr>
<tr class="row-even"><td>2249</td>
<td>没有合约乘数</td>
</tr>
<tr class="row-odd"><td>2250</td>
<td>非交易时间段</td>
</tr>
<tr class="row-even"><td>2251</td>
<td>初始化时持仓数量非法</td>
</tr>
<tr class="row-odd"><td>2252</td>
<td>非该账户的委托</td>
</tr>
<tr class="row-even"><td>2253</td>
<td>非该实例的委托</td>
</tr>
<tr class="row-odd"><td>2254</td>
<td>无法识别证券类型</td>
</tr>
<tr class="row-even"><td>2255</td>
<td>不是期货</td>
</tr>
<tr class="row-odd"><td>2256</td>
<td>标的类型,账户和委托方向不匹配</td>
</tr>
<tr class="row-even"><td>2257</td>
<td>非法的委托类型</td>
</tr>
<tr class="row-odd"><td>2258</td>
<td>该委托已结束</td>
</tr>
<tr class="row-even"><td>2259</td>
<td>超过涨跌停价</td>
</tr>
<tr class="row-odd"><td>2260</td>
<td>不得对敲</td>
</tr>
<tr class="row-even"><td>2270</td>
<td>OMS未初始化完成</td>
</tr>
<tr class="row-odd"><td>2271</td>
<td>实例已存在，不得再次初始化</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="manager-3000-3999">
<span id="api-errors-manager"></span><h3>Manager（3000~3999）<a class="headerlink" href="#manager-3000-3999" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>3000</td>
<td>PB解析失败</td>
</tr>
<tr class="row-odd"><td>3001</td>
<td>无效功能号</td>
</tr>
<tr class="row-even"><td>3002</td>
<td>初始化内存数据库失败</td>
</tr>
<tr class="row-odd"><td>3003</td>
<td>内存数据库没有初始化操作</td>
</tr>
<tr class="row-even"><td>3004</td>
<td>错误的fid</td>
</tr>
<tr class="row-odd"><td>3005</td>
<td>没有记录</td>
</tr>
<tr class="row-even"><td>3006</td>
<td>page_num和page_size的值必须大于1.</td>
</tr>
<tr class="row-odd"><td>3007</td>
<td>手机号不能为空</td>
</tr>
<tr class="row-even"><td>3008</td>
<td>找不到登陆信息，可能后台服务重启，请重新登陆一次</td>
</tr>
<tr class="row-odd"><td>3009</td>
<td>没有找到cpu_serial_no和disk_serial_no相关信息，可能传的值不对</td>
</tr>
<tr class="row-even"><td>3010</td>
<td>云机登出失败，可能没有登陆过</td>
</tr>
<tr class="row-odd"><td>3011</td>
<td>请先做云机登陆</td>
</tr>
<tr class="row-even"><td>3012</td>
<td>参数错误</td>
</tr>
<tr class="row-odd"><td>3013</td>
<td>策略ID是空的</td>
</tr>
<tr class="row-even"><td>3014</td>
<td>没有找到mac_address和disk_serial_no相关信息，请确认传值是否正确!</td>
</tr>
<tr class="row-odd"><td>3015</td>
<td>mac_address不能是空的</td>
</tr>
<tr class="row-even"><td>3016</td>
<td>cpu_serial_no不能是空的</td>
</tr>
<tr class="row-odd"><td>3017</td>
<td>disk_serial_no不能是空的</td>
</tr>
<tr class="row-even"><td>3018</td>
<td>in_param成员缺失</td>
</tr>
<tr class="row-odd"><td>3199</td>
<td>数据库查询失败</td>
</tr>
<tr class="row-even"><td>3200</td>
<td>策略id可能不正确</td>
</tr>
<tr class="row-odd"><td>3201</td>
<td>策略运行模式不正确</td>
</tr>
<tr class="row-even"><td>3202</td>
<td>运行模式错误</td>
</tr>
<tr class="row-odd"><td>3203</td>
<td>实例ID不能为空</td>
</tr>
<tr class="row-even"><td>3204</td>
<td>错误的策略ID或实例ID为空，请确认</td>
</tr>
<tr class="row-odd"><td>3205</td>
<td>保存策略ID失败</td>
</tr>
<tr class="row-even"><td>3206</td>
<td>插入实例表失败</td>
</tr>
<tr class="row-odd"><td>3207</td>
<td>策略的实例已经运行过不能被删除</td>
</tr>
<tr class="row-even"><td>3208</td>
<td>删除策略失败</td>
</tr>
<tr class="row-odd"><td>3209</td>
<td>策略ID不能为空</td>
</tr>
<tr class="row-even"><td>3210</td>
<td>策略ID和实例ID不能同时为空</td>
</tr>
<tr class="row-odd"><td>3211</td>
<td>更新实例表失败</td>
</tr>
<tr class="row-even"><td>3212</td>
<td>实例已经运行过不能被删除</td>
</tr>
<tr class="row-odd"><td>3213</td>
<td>更新实例状态失败</td>
</tr>
<tr class="row-even"><td>3214</td>
<td>错误的实例状态</td>
</tr>
<tr class="row-odd"><td>3215</td>
<td>没找到策略ID对应的策略信息</td>
</tr>
<tr class="row-even"><td>3216</td>
<td>超过最大可创建实例个数</td>
</tr>
<tr class="row-odd"><td>3217</td>
<td>存在非法帐号</td>
</tr>
<tr class="row-even"><td>3299</td>
<td>实例ID不存在，即未能在实例表时找到</td>
</tr>
<tr class="row-odd"><td>3300</td>
<td>系统帐号已经存在</td>
</tr>
<tr class="row-even"><td>3301</td>
<td>资金账号绑定失败，原因是该资金帐号被锁定</td>
</tr>
<tr class="row-odd"><td>3302</td>
<td>资金账户绑定失败，原因是该资金帐号被冻结</td>
</tr>
<tr class="row-even"><td>3303</td>
<td>系统帐号不存在</td>
</tr>
<tr class="row-odd"><td>3304</td>
<td>资金帐号绑定失败，原因是该资金帐号已经被绑定过</td>
</tr>
<tr class="row-even"><td>3305</td>
<td>资金帐号绑定失败，原因是绑定标志错误</td>
</tr>
<tr class="row-odd"><td>3306</td>
<td>资金帐号类型错误</td>
</tr>
<tr class="row-even"><td>3307</td>
<td>资金帐号解绑失败， 原因是未找到该资金帐号的绑定信息</td>
</tr>
<tr class="row-odd"><td>3308</td>
<td>删除系统帐号绑定信息出错</td>
</tr>
<tr class="row-even"><td>3309</td>
<td>插入系统帐号绑定信息失败</td>
</tr>
<tr class="row-odd"><td>3310</td>
<td>系统帐号ID不能为空</td>
</tr>
<tr class="row-even"><td>3311</td>
<td>第一次资金帐号登陆必须是股票帐号</td>
</tr>
<tr class="row-odd"><td>3312</td>
<td>这个资金帐号类型已经绑定过了</td>
</tr>
<tr class="row-even"><td>3313</td>
<td>最后一个帐号不能被解绑</td>
</tr>
<tr class="row-odd"><td>3314</td>
<td>这种类型的资金帐号的绑定还未实现</td>
</tr>
<tr class="row-even"><td>3315</td>
<td>未知的资金帐号类型</td>
</tr>
<tr class="row-odd"><td>3316</td>
<td>错误的资金帐号类型</td>
</tr>
<tr class="row-even"><td>3317</td>
<td>资金帐号、资金帐号类型必填</td>
</tr>
<tr class="row-odd"><td>3318</td>
<td>找不到系统帐号</td>
</tr>
<tr class="row-even"><td>3319</td>
<td>没找到迅投帐号</td>
</tr>
<tr class="row-odd"><td>3320</td>
<td>被绑定的资金帐号存在系统帐号，如果要作绑定，请先注销该资金帐号</td>
</tr>
<tr class="row-even"><td>3321</td>
<td>注销资金帐号的系统帐号失败</td>
</tr>
<tr class="row-odd"><td>3322</td>
<td>该帐号禁止登陆，请先授权</td>
</tr>
<tr class="row-even"><td>3323</td>
<td>登陆失败次数已经达到上限</td>
</tr>
<tr class="row-odd"><td>3399</td>
<td>错误的绑定标志</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="api-errors-md">
<span id="id3"></span><h3>行情服务（7000~7999）<a class="headerlink" href="#api-errors-md" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7000</td>
<td>未知系统错误</td>
</tr>
<tr class="row-odd"><td>7001</td>
<td>历史行情请求参数错误</td>
</tr>
<tr class="row-even"><td>7002</td>
<td>历史行情打包报文错误</td>
</tr>
<tr class="row-odd"><td>7003</td>
<td>历史行情通道错误，到服务器的连接通道不可用</td>
</tr>
<tr class="row-even"><td>7004</td>
<td>历史行情get报文错误</td>
</tr>
<tr class="row-odd"><td>7005</td>
<td>历史行情解包报文错误</td>
</tr>
<tr class="row-even"><td>7006</td>
<td>历史行情服务方错误</td>
</tr>
<tr class="row-odd"><td>7007</td>
<td>历史行情用户中断</td>
</tr>
<tr class="row-even"><td>7008</td>
<td>历史行情应用层失败，服务方服务失败</td>
</tr>
<tr class="row-odd"><td>7009</td>
<td>历史行情错误的客户端handle</td>
</tr>
<tr class="row-even"><td>7010</td>
<td>历史行情服务连接失败</td>
</tr>
<tr class="row-odd"><td>7011</td>
<td>历史行情请求超时</td>
</tr>
<tr class="row-even"><td>7012</td>
<td>实时行情错误的客户端handle</td>
</tr>
<tr class="row-odd"><td>7013</td>
<td>实时行情TCP连接错误</td>
</tr>
<tr class="row-even"><td>7014</td>
<td>实时行情代理连接错误</td>
</tr>
<tr class="row-odd"><td>7015</td>
<td>实时行情代理验证错误</td>
</tr>
<tr class="row-even"><td>7016</td>
<td>实时行情连接断开</td>
</tr>
<tr class="row-odd"><td>7017</td>
<td>实时行情TCP IO错误</td>
</tr>
<tr class="row-even"><td>7018</td>
<td>实时行情连接超时</td>
</tr>
<tr class="row-odd"><td>7019</td>
<td>实时行情版本错误</td>
</tr>
<tr class="row-even"><td>7020</td>
<td>实时行情无此账号</td>
</tr>
<tr class="row-odd"><td>7021</td>
<td>实时行情用户验证错误</td>
</tr>
<tr class="row-even"><td>7022</td>
<td>实时行情订阅标签错误</td>
</tr>
<tr class="row-odd"><td>7023</td>
<td>实时行情连接失败</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="api-8000-8999">
<span id="api-errors-td"></span><h3>交易API（8000~8999）<a class="headerlink" href="#api-8000-8999" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8000</td>
<td>系统内部错误</td>
</tr>
<tr class="row-odd"><td>8001</td>
<td>参数非法</td>
</tr>
<tr class="row-even"><td>8002</td>
<td>网络超时</td>
</tr>
<tr class="row-odd"><td>8003</td>
<td>消息发送失败</td>
</tr>
<tr class="row-even"><td>8004</td>
<td>非法协议包</td>
</tr>
<tr class="row-odd"><td>8005</td>
<td>打包失败</td>
</tr>
<tr class="row-even"><td>8006</td>
<td>解包失败</td>
</tr>
<tr class="row-odd"><td>8007</td>
<td>内存不够</td>
</tr>
<tr class="row-even"><td>8008</td>
<td>非法标的ID</td>
</tr>
<tr class="row-odd"><td>8009</td>
<td>交易服务内部初始化错误</td>
</tr>
<tr class="row-even"><td>8010</td>
<td>交易服务未连接</td>
</tr>
<tr class="row-odd"><td>8011</td>
<td>资金账户登录失败</td>
</tr>
<tr class="row-even"><td>8012</td>
<td>交易服务未初始化</td>
</tr>
<tr class="row-odd"><td>8013</td>
<td>没有数据</td>
</tr>
<tr class="row-even"><td>8014</td>
<td>订阅委托和成交回报失败</td>
</tr>
<tr class="row-odd"><td>8015</td>
<td>交易账号相关字段非法</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="api-errors-template">
<span id="id4"></span><h3>策略模板（9000~9999）<a class="headerlink" href="#api-errors-template" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">错误码</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>9000</td>
<td>系统内部错误</td>
</tr>
<tr class="row-odd"><td>9001</td>
<td>请求参数非法</td>
</tr>
<tr class="row-even"><td>9002</td>
<td>非法的当前状态</td>
</tr>
<tr class="row-odd"><td>9003</td>
<td>操作超时</td>
</tr>
<tr class="row-even"><td>9004</td>
<td>消息发送失败</td>
</tr>
<tr class="row-odd"><td>9005</td>
<td>非法协议包</td>
</tr>
<tr class="row-even"><td>9006</td>
<td>打包失败</td>
</tr>
<tr class="row-odd"><td>9007</td>
<td>解包失败</td>
</tr>
<tr class="row-even"><td>9008</td>
<td>内存不够</td>
</tr>
<tr class="row-odd"><td>9009</td>
<td>网关登录失败</td>
</tr>
<tr class="row-even"><td>9010</td>
<td>加载配置文件失败</td>
</tr>
<tr class="row-odd"><td>9011</td>
<td>加载行情动态库失败</td>
</tr>
<tr class="row-even"><td>9012</td>
<td>加载交易动态库失败</td>
</tr>
<tr class="row-odd"><td>9013</td>
<td>策略库已退出</td>
</tr>
<tr class="row-even"><td>9014</td>
<td>配置文件或客户端设置的run_mode不支持</td>
</tr>
<tr class="row-odd"><td>9015</td>
<td>操作本地数据库失败</td>
</tr>
<tr class="row-even"><td>9016</td>
<td>时间格式不对</td>
</tr>
<tr class="row-odd"><td>9017</td>
<td>时间超过当前回测时间，回测时不能使用未来数据</td>
</tr>
<tr class="row-even"><td>9018</td>
<td>策略使用的资金账号列表不能为空</td>
</tr>
<tr class="row-odd"><td>9019</td>
<td>字符编码转换失败</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-intro/examples"></span><div class="section" id="intro-examples">
<span id="id1"></span><h2>策略示例<a class="headerlink" href="#intro-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="intro-examples-buy-and-hold">
<span id="id2"></span><h3>买入&amp;持有策略<a class="headerlink" href="#intro-examples-buy-and-hold" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Buy and Hold</span>

<span class="kn">from</span> <span class="nn">sparkquant</span> <span class="k">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="c1"># 设置这个策略当中会用到的参数，在策略中可以随时调用，这个策略使用买入并持有万科A股票</span>
    <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">=</span> <span class="s1">&#39;SZ.000002&#39;</span>   <span class="c1"># 使用的合约编号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span> <span class="o">=</span> <span class="s1">&#39;6814&#39;</span>     <span class="c1"># 报单时指定的账号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span> <span class="o">=</span> <span class="mi">100</span>           <span class="c1"># 报单数量（股票单位：股，期货单位：手）</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="kc">False</span>           <span class="c1"># 是否已报单</span>

    <span class="c1"># 订阅行情数据</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;订阅合约...&#39;</span><span class="p">)</span>
    <span class="n">subscribe</span><span class="p">([</span><span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">+</span> <span class="s1">&#39;.bar&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">on_bar</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">bar_dict</span><span class="p">):</span>
    <span class="c1"># print(bar_dict)</span>
    <span class="c1"># 接收bar数据，在收到第一个bar行情时买入股票</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">fired</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;报单...&quot;</span><span class="p">)</span>
        <span class="n">order_price</span> <span class="o">=</span> <span class="n">bar_dict</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>  <span class="c1"># 使用最新价</span>
        <span class="n">order_volume</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span><span class="p">,</span> <span class="n">order_price</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">fired</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">on_order_status</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="c1"># 如何接收订单状态变化事件</span>
    <span class="c1"># 在实盘中，需要考虑报单不能全部成交的情况，并在此处进行追单处理</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到订单状态变化：</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_execution_report</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">):</span>
    <span class="c1"># 如何接收成交回报事件</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到成交回报： </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 如何开始运行策略</span>
    <span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
        <span class="n">on_bar</span><span class="o">=</span><span class="n">on_bar</span><span class="p">,</span>
        <span class="n">on_order_status</span><span class="o">=</span><span class="n">on_order_status</span><span class="p">,</span>
        <span class="n">on_execution_report</span><span class="o">=</span><span class="n">on_execution_report</span><span class="p">,</span>
        <span class="n">config_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">log_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">is_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="intro-examples-sma">
<span id="id3"></span><h3>双均线策略<a class="headerlink" href="#intro-examples-sma" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># SMA</span>

<span class="kn">from</span> <span class="nn">sparkquant</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">talib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="c1"># 设置这个策略当中会用到的参数，在策略中可以随时调用，这个策略使用长短均线，我们在这里设定长线和短线的区间，</span>
    <span class="c1"># 在调试寻找最佳区间的时候只需要在这里进行数值改动</span>
    <span class="n">context</span><span class="o">.</span><span class="n">SHORT</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">context</span><span class="o">.</span><span class="n">LONG</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">=</span> <span class="s1">&#39;SZ.000002&#39;</span>  <span class="c1"># 使用的合约编号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span> <span class="o">=</span> <span class="s1">&#39;6814&#39;</span>  <span class="c1"># 报单时指定的账号</span>
    <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># 每次的报单数量</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;订阅合约...&#39;</span><span class="p">)</span>
    <span class="n">subscribe</span><span class="p">([</span><span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span> <span class="o">+</span> <span class="s1">&#39;.tick&#39;</span><span class="p">])</span>  <span class="c1"># 订阅行情数据</span>


<span class="k">def</span> <span class="nf">on_tick</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">tick_dict</span><span class="p">):</span>
    <span class="c1"># 接收tick数据</span>
    <span class="c1"># print(&#39;\n接收tick数据：\n&#39;, tick_dict)</span>

    <span class="c1"># 因为策略需要用到均线，所以需要读取历史数据，获取当前时间前N个tick的最新价</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">history_n</span><span class="p">([</span><span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">],</span> <span class="s2">&quot;tick&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">LONG</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;match&#39;</span><span class="p">])</span>

    <span class="c1"># 将list数据转换成ndarray格式，供talib调用</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># 使用talib计算长短两根均线，均线以array的格式表达</span>
    <span class="n">short_avg</span> <span class="o">=</span> <span class="n">talib</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">SHORT</span><span class="p">)</span>
    <span class="n">long_avg</span> <span class="o">=</span> <span class="n">talib</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">LONG</span><span class="p">)</span>

    <span class="c1"># 如果短均线从上往下跌破长均线，也就是在目前的行情短线平均值低于长线平均值，而上一个行情的短线平均值高于长线平均值</span>
    <span class="k">if</span> <span class="n">short_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">long_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">short_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">long_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;卖出指定数量证券</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">order_price</span> <span class="o">=</span> <span class="n">tick_dict</span><span class="p">[</span><span class="s1">&#39;bid_price&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 使用bid_price的1档价格</span>
        <span class="n">order_volume</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order_price</span><span class="p">)</span>

    <span class="c1"># 如果短均线从下往上突破长均线，为入场信号</span>
    <span class="k">if</span> <span class="n">short_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">long_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">short_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">long_avg</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">买入指定数量证券：</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">order_price</span> <span class="o">=</span> <span class="n">tick_dict</span><span class="p">[</span><span class="s1">&#39;ask_price&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 使用ask_price的1档价格</span>
        <span class="n">order_volume</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">ACCOUNT_ID</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">SYMBOL</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">VOLUME</span><span class="p">,</span> <span class="n">order_price</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_order_status</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="c1"># 如何接收订单状态变化事件</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到订单状态变化：</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_execution_report</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">):</span>
    <span class="c1"># 如何接收成交回报事件</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">收到成交回报： </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exec_report</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">on_cancel_order</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">order_cancel</span><span class="p">):</span>
    <span class="c1"># 如何接收撤单应答事件</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;收到撤单应答：</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">order_cancel</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># 如何开始运行策略</span>
    <span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
        <span class="n">on_tick</span><span class="o">=</span><span class="n">on_tick</span><span class="p">,</span>
        <span class="n">on_order_status</span><span class="o">=</span><span class="n">on_order_status</span><span class="p">,</span>
        <span class="n">on_execution_report</span><span class="o">=</span><span class="n">on_execution_report</span><span class="p">,</span>
        <span class="n">on_cancel_order</span><span class="o">=</span><span class="n">on_cancel_order</span><span class="p">,</span>
        <span class="n">config_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">log_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="n">is_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-intro/pack"></span><div class="section" id="intro-pack">
<span id="id1"></span><h2>策略加密<a class="headerlink" href="#intro-pack" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>本示例在Win7-32，Win7-64， Win10-32，Win10-64，WinServer-2012, WinServer-2012R2，WinServer-2016机器上测试通过。</li>
<li>本示例在python3.5（32&amp;64）及以上测试通过。</li>
</ul>
</div>
<div class="section" id="intro-pack-init">
<span id="id2"></span><h3>1. 环境准备<a class="headerlink" href="#intro-pack-init" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cython">
<span id="intro-pack-init-cython"></span><h4>1.1 安装cython<a class="headerlink" href="#cython" title="Permalink to this headline">¶</a></h4>
<p>程序需要使用cython包，可以使用pip list查看是否安装。
如未安装请使用 pip install cython 命令进行安装。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>如环境变量Path中默认的Python不是需要的环境，要么把它改为默认开发环境，要么在执行命令时指定全路径，譬如pip安装在D:\ProgramFiles\Anaconda3\Scripts目录下，运行命令时可先切换到这个目录再运行具体命令。</li>
</ul>
</div>
</div>
<div class="section" id="intro-pack-init-unzip">
<span id="id3"></span><h4>1.2 解压加密工具<a class="headerlink" href="#intro-pack-init-unzip" title="Permalink to this headline">¶</a></h4>
<p>解压pack-Vxx.xx.xx.7z（该文件在下载的策略模板压缩包中，参考 <a class="reference internal" href="index.html#intro-install-download"><span class="std std-ref">1. 下载客户端</span></a> ），运行pack.exe即可工作。</p>
<img alt="_images/unzip_pack.png" src="_images/unzip_pack.png" />
</div>
</div>
<div class="section" id="intro-pack-main">
<span id="id4"></span><h3>2. 加密可执行程序和动态库<a class="headerlink" href="#intro-pack-main" title="Permalink to this headline">¶</a></h3>
<div class="section" id="intro-pack-main-ui">
<span id="id5"></span><h4>2.1 程序界面<a class="headerlink" href="#intro-pack-main-ui" title="Permalink to this headline">¶</a></h4>
<img alt="_images/main_UI.png" src="_images/main_UI.png" />
</div>
<div class="section" id="intro-pack-main-env">
<span id="id6"></span><h4>2.2 选择版本<a class="headerlink" href="#intro-pack-main-env" title="Permalink to this headline">¶</a></h4>
<p>程序启动时会自动检测环境变量path，如果path中配置了多个python版本，会全部列出（如下图所示），并自动选择其中一个用于打包。用户可自行在列出的版本中切换，如果列出的python版本中没有用户需要的版本，可点击“添加”按钮，选择python.exe所在的文件夹。在主界面的左下角会显示当前选择的python版本信息。</p>
<img alt="_images/select_path.png" src="_images/select_path.png" />
</div>
<div class="section" id="exe">
<span id="intro-pack-main-exe"></span><h4>2.3 添加需要加密成exe的文件<a class="headerlink" href="#exe" title="Permalink to this headline">¶</a></h4>
<p>点击“添加”按钮（如下图），选择需要打包的python文件。</p>
<img alt="_images/add_py_files_to_exe.png" src="_images/add_py_files_to_exe.png" />
</div>
<div class="section" id="pyd">
<span id="intro-pack-main-pyd"></span><h4>2.4 添加需要加密成pyd的文件<a class="headerlink" href="#pyd" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>一个策略只能有一个main的py文件加密成exe。当一个策略包含多个py文件时，除main文件外，其他py文件可以加密成pyd格式。</li>
</ul>
</div>
<p>点击“添加”按钮（如下图），选择需要打包的python文件，按住Ctrl可多选。
选中文件点击“删除”可删除添加的python文件，双击文件也可删除。</p>
<img alt="_images/add_py_files_to_pyd.png" src="_images/add_py_files_to_pyd.png" />
</div>
</div>
<div class="section" id="intro-pack-run">
<span id="id7"></span><h3>3. 运行加密策略<a class="headerlink" href="#intro-pack-run" title="Permalink to this headline">¶</a></h3>
<p>在被加密的py文件同一目录下，可以找到加密的exe文件。</p>
<p>直接执行exe，即可运行策略进行测试。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>实盘上传策略时，可将py文件删除，然后将策略执行文件及其依赖库打包，并上传实盘云机。</li>
</ul>
</div>
</div>
<div class="section" id="intro-pack-qna">
<span id="id8"></span><h3>4. 常见问题<a class="headerlink" href="#intro-pack-qna" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pyhonxx-dll">
<span id="intro-pack-qna-1"></span><h4>4.1 计算机丢失Pyhonxx.dll<a class="headerlink" href="#pyhonxx-dll" title="Permalink to this headline">¶</a></h4>
<img alt="_images/error_missing_dll.png" src="_images/error_missing_dll.png" />
<p>程序打包完毕会将对应的pythonxx.dll文件拷贝到exe生成目录，如果程序移植到其他机器，需要将对应的dll拷贝到exe文件平级的目录。</p>
</div>
<div class="section" id="no-module-named-encodings">
<span id="intro-pack-qna-2"></span><h4>4.2 No module named ‘encodings’<a class="headerlink" href="#no-module-named-encodings" title="Permalink to this headline">¶</a></h4>
<p>部分机器上运行出现找不到encodings模块，需要添加环境变量PYTHONHOME，值设定为python.exe所在的文件夹。</p>
<img alt="_images/error_missing_encodings.png" src="_images/error_missing_encodings.png" />
<img alt="_images/error_update_path.png" src="_images/error_update_path.png" />
</div>
<div class="section" id="intro-pack-qna-3">
<span id="id9"></span><h4>4.3 提示没有安装cython<a class="headerlink" href="#intro-pack-qna-3" title="Permalink to this headline">¶</a></h4>
<img alt="_images/no_cython.png" src="_images/no_cython.png" />
<p>通过pip install安装cython:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install cython
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, gtja.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.2',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>